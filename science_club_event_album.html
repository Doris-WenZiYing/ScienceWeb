<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>科學會管理系統-活動相簿</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <script src="notification-center.js" defer></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        width: 100%;
        font-family: "Microsoft JhengHei", "Arial", sans-serif;
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        overflow: hidden;
      }

      .header {
        height: 70px;
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 30px;
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        position: relative;
        z-index: 100;
      }

      .header::before {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #8360c3 0%, #2ebf91 100%);
      }

      .header-left {
        display: flex;
        align-items: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .header-left:hover {
        transform: scale(1.02);
      }

      .header img.logo {
        height: 50px;
        filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.1));
        transition: transform 0.3s ease;
        margin-right: 15px;
      }

      .header-title {
        font-size: 24px;
        font-weight: 300;
        color: #333;
        transition: color 0.3s ease;
      }

      .header-left:hover .header-title {
        color: #8360c3;
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 25px;
        position: relative;
      }

      .icon {
        position: relative;
        padding: 12px;
        border-radius: 50%;
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(131, 96, 195, 0.3);
        border: 2px solid rgba(255, 255, 255, 0.2);
        animation: pulse 2s infinite;
      }

      .icon:hover {
        transform: translateY(-3px) scale(1.1);
        box-shadow: 0 12px 35px rgba(131, 96, 195, 0.5);
        background: linear-gradient(135deg, #9d7ce6 0%, #3dd5a3 100%);
      }

      .icon:active {
        transform: translateY(-1px) scale(1.05);
        transition: all 0.1s ease;
      }

      .icon i {
        font-size: 20px;
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        animation: bellShake 0.5s ease-in-out infinite alternate;
      }

      .icon::after {
        content: "3";
        position: absolute;
        top: -5px;
        right: -5px;
        background: linear-gradient(135deg, #ff4757 0%, #ff3742 100%);
        color: white;
        border-radius: 50%;
        width: 22px;
        height: 22px;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        box-shadow: 0 2px 8px rgba(255, 71, 87, 0.4);
        border: 2px solid white;
        animation: bounce 1s ease-in-out infinite;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 4px 15px rgba(131, 96, 195, 0.3);
        }
        50% {
          box-shadow: 0 4px 25px rgba(131, 96, 195, 0.6);
        }
        100% {
          box-shadow: 0 4px 15px rgba(131, 96, 195, 0.3);
        }
      }

      @keyframes bellShake {
        0% {
          transform: rotate(-5deg);
        }
        100% {
          transform: rotate(5deg);
        }
      }

      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-3px);
        }
        60% {
          transform: translateY(-2px);
        }
      }

      .avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 3px solid #fff;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .avatar:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(131, 96, 195, 0.3);
      }

      .avatar i {
        font-size: 20px;
        color: white;
      }

      .dropdown {
        position: absolute;
        top: 65px;
        right: 0;
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        display: none;
        min-width: 120px;
        z-index: 1000;
        overflow: hidden;
        animation: dropdownFade 0.3s ease;
      }

      @keyframes dropdownFade {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .dropdown a {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        text-decoration: none;
        color: #333;
        font-size: 14px;
        transition: all 0.2s ease;
      }

      .dropdown a:hover {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        color: white;
      }

      .dropdown a i {
        margin-right: 8px;
        width: 16px;
      }

      /* 通知面板樣式 */
      .notification-panel {
        position: absolute;
        top: 65px;
        right: 80px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        display: none;
        width: 380px;
        max-height: 500px;
        z-index: 1000;
        animation: dropdownFade 0.3s ease;
        overflow: hidden;
      }

      .notification-header {
        padding: 20px;
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-radius: 15px 15px 0 0;
      }

      .notification-header h3 {
        font-size: 16px;
        font-weight: 600;
        margin: 0;
      }

      .notification-actions {
        display: flex;
        gap: 10px;
      }

      .notification-btn {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        padding: 5px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.3s ease;
      }

      .notification-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.05);
      }

      .notification-list {
        max-height: 400px;
        overflow-y: auto;
      }

      .notification-item {
        padding: 15px 20px;
        border-bottom: 1px solid #f0f0f0;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        display: flex;
        gap: 12px;
      }

      .notification-item:hover {
        background: rgba(131, 96, 195, 0.05);
      }

      .notification-item.unread {
        background: rgba(131, 96, 195, 0.08);
      }

      .notification-item.unread::before {
        content: "";
        position: absolute;
        left: 8px;
        top: 50%;
        transform: translateY(-50%);
        width: 8px;
        height: 8px;
        background: #e74c3c;
        border-radius: 50%;
      }

      .notification-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        flex-shrink: 0;
      }

      .notification-icon.activity {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        color: white;
      }

      .notification-icon.deadline {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
      }

      .notification-icon.announcement {
        background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        color: white;
      }

      .notification-content {
        flex: 1;
      }

      .notification-title {
        font-size: 14px;
        font-weight: 600;
        color: #333;
        margin-bottom: 4px;
      }

      .notification-text {
        font-size: 13px;
        color: #666;
        margin-bottom: 4px;
      }

      .notification-time {
        font-size: 11px;
        color: #999;
      }

      .notification-delete {
        position: absolute;
        right: 15px;
        top: 15px;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: rgba(231, 76, 60, 0.1);
        color: #e74c3c;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        opacity: 0;
        transition: all 0.3s ease;
        z-index: 5;
      }

      .notification-item:hover .notification-delete {
        opacity: 1;
      }

      .notification-delete:hover {
        background: #e74c3c;
        color: white;
        transform: scale(1.1);
      }

      .notification-empty {
        padding: 60px 20px;
        text-align: center;
        color: #999;
      }

      .notification-empty i {
        font-size: 48px;
        color: #ddd;
        margin-bottom: 15px;
      }

      .notification-list::-webkit-scrollbar {
        width: 6px;
      }
      .notification-list::-webkit-scrollbar-track {
        background: #f0f0f0;
      }
      .notification-list::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        border-radius: 3px;
      }

      .main {
        display: flex;
        height: calc(100% - 70px);
        width: 100%;
        gap: 0;
        overflow: hidden;
      }

      .sidebar {
        width: 280px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 0; /* 移除頂部 padding */
        display: flex;
        flex-direction: column;
        box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow-y: auto;
        overflow-x: hidden;
      }
      /* 新增 Menu 的頂部 padding 以取代 sidebar 的 padding */
      .menu {
        flex: 1;
        margin-top: 20px; /* 保留頂部的間距，但可以調整為 0 */
        padding-top: 30px; /* 增加 padding-top 以保留整體菜單的視覺位置 */
      }
      /* 移除行事曆上方的空白，將 menu-item 移至 sidebar 頂部 */
      /* 讓第一個連結與頂部更貼近 */
      .menu-item:first-child .menu-link {
        margin-top: -5px;
      }

      .sidebar::before {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(180deg, #8360c3 0%, #2ebf91 100%);
      }

      .menu {
        flex: 1;
        margin-top: 0; /* 移除原本的 margin-top: 20px; */
      }

      .menu-item {
        display: block;
        position: relative;
      }

      .menu-link {
        display: flex;
        align-items: center;
        padding: 15px 25px;
        text-decoration: none;
        color: #555;
        font-size: 15px;
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
        cursor: pointer;
      }

      .menu-link:hover,
      .menu-link.active {
        color: #8360c3;
        background: rgba(131, 96, 195, 0.1);
        border-left: 4px solid #8360c3;
        transform: translateX(5px);
      }

      .menu-link i {
        margin-right: 12px;
        width: 20px;
        font-size: 16px;
      }

      .menu-arrow {
        margin-left: auto;
        font-size: 12px;
        transition: transform 0.3s ease;
      }

      .menu-item.expanded .menu-arrow {
        transform: rotate(180deg);
      }

      .submenu {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        background: rgba(131, 96, 195, 0.05);
      }

      .submenu.show {
        max-height: 500px;
      }

      .submenu-item {
        position: relative;
      }

      .submenu-link {
        display: flex;
        align-items: center;
        padding: 12px 25px 12px 45px;
        text-decoration: none;
        color: #666;
        font-size: 14px;
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
        cursor: pointer;
      }

      .submenu-link:hover {
        color: #8360c3;
        background: rgba(131, 96, 195, 0.1);
        border-left: 4px solid #8360c3;
        transform: translateX(5px);
      }

      .submenu-link i {
        margin-right: 10px;
        width: 16px;
        font-size: 14px;
      }

      /* --- 右側內容區域 (Content) --- */
      .content {
        flex: 1;
        padding: 40px;
        background: #ffffff;
        backdrop-filter: none;
        overflow-y: auto;
        overflow-x: hidden;
        border-radius: 20px;
        margin: 20px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      }

      /* --- 相簿標題區塊調整 --- */
      .album-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
      }

      .album-header h1 {
        font-size: 28px;
        font-weight: 700;
        color: #333;
      }

      /* 相簿卡片列表容器 */
      .album-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 25px;
        padding: 10px;
      }

      /* 相簿卡片 */
      .album-card {
        background: #fff;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        border: 1px solid #eee;
        position: relative; /* 新增 for menu positioning */
      }

      .album-card-clickable {
        cursor: pointer;
        display: block; /* 讓 cover 和 info 可以一起被點擊 */
      }

      .album-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(131, 96, 195, 0.3);
      }

      .album-card-cover {
        height: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 40px;
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        opacity: 0.9;
      }

      .album-card-info {
        padding: 15px 20px;
      }

      .album-card-title {
        font-size: 18px;
        font-weight: 700;
        color: #333;
        margin-bottom: 8px;
      }

      .album-card-date {
        font-size: 13px;
        color: #8360c3;
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 10px;
      }

      .album-card-desc {
        font-size: 13px;
        color: #666;
        height: 36px;
        /* 兩行文字空間 */
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        line-clamp: 2;
      }

      /* 相簿管理按鈕及選單 */
      .album-manage-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255, 255, 255, 0.8);
        border: 1px solid #ddd;
        color: #666;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s ease;
        z-index: 10;
      }

      .album-manage-btn:hover {
        background: #fff;
        color: #8360c3;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .album-manage-menu {
        position: absolute;
        top: 40px;
        right: 0;
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        display: none;
        min-width: 100px;
        z-index: 20;
        overflow: hidden;
      }

      .album-manage-menu.show {
        display: block;
      }

      .album-manage-menu a {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        text-decoration: none;
        color: #333;
        font-size: 14px;
        transition: background 0.2s ease;
      }

      .album-manage-menu a:hover {
        background: #f0f0f0;
      }

      .album-manage-menu a.delete:hover {
        background: #fbecec;
        color: #e74c3c;
      }

      .album-manage-menu a i {
        margin-right: 8px;
      }

      /* 詳情頁面樣式 */
      .album-detail-view {
        display: none;
        /* 預設隱藏 */
      }

      .detail-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
      }

      .back-btn {
        background: #f0f0f0;
        border: none;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        color: #666;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
      }

      .back-btn:hover {
        background: #e0e0e0;
        color: #333;
      }

      .upload-form-group {
        background: rgba(131, 96, 195, 0.05);
        border: 2px dashed #8360c3;
        border-radius: 15px;
        padding: 40px 20px;
        text-align: center;
        cursor: pointer;
        margin-bottom: 30px;
        transition: all 0.3s ease;
        /* 修正跑版：確保獨佔一行 */
        display: block;
        width: 100%;
      }

      .upload-form-group:hover {
        background: rgba(131, 96, 195, 0.1);
        transform: translateY(-2px);
      }

      .upload-form-group i {
        font-size: 40px;
        color: #8360c3;
        margin-bottom: 10px;
      }

      .upload-form-group p {
        color: #555;
        font-weight: 500;
      }

      .upload-file-input {
        display: none;
      }

      .media-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 20px;
        padding-bottom: 20px;
      }

      .media-item {
        position: relative;
        aspect-ratio: 1 / 1;
        overflow: hidden;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .media-item:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
      }

      .media-item img,
      .media-item video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        cursor: pointer;
      }

      .delete-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(231, 76, 60, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        cursor: pointer;
        font-size: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 10;
      }

      .media-item:hover .delete-btn {
        opacity: 1;
      }

      .delete-btn:hover {
        background: #c0392b;
      }

      /* 彈跳視窗樣式 (Modal) */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        animation: fadeIn 0.3s ease;
      }

      .modal-overlay.show {
        display: flex;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }

        to {
          opacity: 1;
        }
      }

      .modal {
        background: white;
        border-radius: 20px;
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: slideUp 0.3s ease;
      }

      @keyframes slideUp {
        from {
          transform: translateY(50px);
          opacity: 0;
        }

        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .modal-header {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        color: white;
        padding: 25px;
        border-radius: 20px 20px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-header h2 {
        font-size: 20px;
        font-weight: 600;
        margin: 0;
      }

      .modal-close {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 18px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-close:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: rotate(90deg);
      }

      .modal-body {
        padding: 30px;
      }

      /* 預覽左右導覽按鈕 */
      .preview-nav-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 44px;
        height: 44px;
        border-radius: 50%;
        border: none;
        background: rgba(0, 0, 0, 0.4);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 3;
      }
      .preview-nav-btn:hover {
        background: rgba(0, 0, 0, 0.55);
      }
      .preview-prev {
        left: 10px;
      }
      .preview-next {
        right: 10px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
        font-size: 14px;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        font-size: 14px;
        transition: all 0.3s ease;
        font-family: "Microsoft JhengHei", "Arial", sans-serif;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #8360c3;
        box-shadow: 0 0 0 3px rgba(131, 96, 195, 0.1);
      }

      .form-group textarea {
        resize: vertical;
        min-height: 100px;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      /* 提交按鈕樣式保持不變 */
      .btn-submit {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(131, 96, 195, 0.4);
      }

      .modal-footer {
        padding: 20px 30px;
        border-top: 1px solid #f0f0f0;
        display: flex;
        justify-content: flex-end;
        gap: 12px;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      /* --- 樣式修改點 3: 修改取消按鈕樣式 --- */
      .btn-cancel {
        background: white; /* 純白背景 */
        color: #666; /* 文字顏色保持灰色 */
        border: 2px solid #ccc; /* 灰色邊框 */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); /* 輕微陰影 */
      }

      .btn-cancel:hover {
        background: #f0f0f0; /* 懸停時略微變灰 */
        color: #333; /* 文字略微變深 */
        border-color: #aaa; /* 邊框略微變深 */
      }

      /* 滾動條樣式調整 (保持不變) */
      .modal::-webkit-scrollbar {
        width: 6px;
      }

      .modal::-webkit-scrollbar-track {
        background: #f0f0f0;
      }

      .modal::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        border-radius: 3px;
      }

      .sidebar::-webkit-scrollbar {
        width: 6px;
      }

      .sidebar::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
      }

      .sidebar::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        border-radius: 4px;
      }

      .content::-webkit-scrollbar {
        width: 8px;
      }

      .content::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
      }

      .content::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        border-radius: 4px;
      }

      /* 媒體查詢 (保持不變) */
      @media (max-width: 1024px) {
        .content {
          margin: 10px;
        }
      }

      @media (max-width: 768px) {
        .main {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
          height: auto;
        }

        .content {
          padding: 20px;
          margin: 10px;
        }

        .album-list {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>

  <body class="sci-page">
    <div class="header">
      <div
        class="header-left"
        onclick="location.href='science_club_activity_calendar.html';"
      >
        <img src="image/logo1.gif" alt="Logo" class="logo" />
      </div>
      <div class="header-right">
        <div class="icon" id="notificationIcon">
          <i class="fas fa-bell"></i>
        </div>
        <div class="notification-panel" id="notificationPanel">
          <div class="notification-header">
            <h3>通知</h3>
            <div class="notification-actions">
              <button class="notification-btn">全部已讀</button>
              <button
                class="notification-btn"
                onclick="clearAllNotifications()"
              >
                清除全部
              </button>
            </div>
          </div>
          <div class="notification-list" id="notificationList"></div>
        </div>
        <div class="avatar" id="avatar">
          <i class="fas fa-user-shield"></i>
        </div>
        <div class="dropdown" id="dropdown">
          <a href="login_science_club.html">
            <i class="fas fa-sign-out-alt"></i> 登出
          </a>
        </div>
      </div>
    </div>

    <div class="main">
      <div class="sidebar">
        <div class="menu">
          <div class="menu-item">
            <a href="science_club_activity_calendar.html" class="menu-link">
              <i class="fas fa-calendar"></i> 行事曆
            </a>
          </div>

          <div class="menu-item">
            <a href="science_club_event_album.html" class="menu-link active">
              <i class="fas fa-image"></i> 活動相簿
            </a>
          </div>

          <div class="menu-item">
            <div class="menu-link" onclick="toggleMenu(this); return false;">
              <i class="fas fa-bullhorn"></i> 發佈公告/活動/表單
              <i class="fas fa-chevron-down menu-arrow"></i>
            </div>
            <div class="submenu">
              <div class="submenu-item">
                <a
                  href="science_club_publish_announcement.html"
                  class="submenu-link"
                >
                  <i class="fas fa-bullhorn"></i> 發佈公告
                </a>
              </div>
              <div class="submenu-item">
                <a
                  href="science_club_activity_publish.html"
                  class="submenu-link"
                >
                  <i class="fas fa-plus-circle"></i> 發佈比賽及活動
                </a>
              </div>
              <div class="submenu-item">
                <a href="science_club_table_publish.html" class="submenu-link">
                  <i class="fas fa-comment-alt"></i> 發佈活動反饋表單
                </a>
              </div>
            </div>
          </div>

          <div class="menu-item">
            <a href="science_club_name_manage.html" class="menu-link">
              <i class="fas fa-user-edit"></i> 報名人員名單管理
            </a>
          </div>

          <div class="menu-item">
            <a href="science_club_statistics.html" class="menu-link">
              <i class="fas fa-trophy"></i> 統計比賽名次
            </a>
          </div>

          <div class="menu-item">
            <a href="science_club_upload_files.html" class="menu-link">
              <i class="fas fa-upload"></i> 開放上傳檔案
            </a>
          </div>

          <div class="menu-item">
            <a href="science_club_request_review.html" class="menu-link">
              <i class="fas fa-file-signature"></i> 請假申請
            </a>
          </div>

          <div class="menu-item">
            <a href="science_club_meeting_records.html" class="menu-link">
              <i class="fas fa-clipboard"></i> 開會紀錄
            </a>
          </div>

          <div class="menu-item">
            <a href="science_club_image_recognition.html" class="menu-link">
              <i class="fas fa-eye"></i> 圖片識別
            </a>
          </div>
        </div>
      </div>

      <div class="content">
        <div id="albumListView">
          <div class="album-header">
            <h1>活動相簿</h1>
            <button class="btn-submit" onclick="openAddAlbumModal()">
              <i class="fas fa-plus-circle"></i> 新增活動相簿
            </button>
          </div>
          <div class="album-list" id="albumList"></div>
        </div>

        <div id="albumDetailView" class="album-detail-view">
          <div class="detail-header">
            <button class="back-btn" onclick="showAlbumList()">
              <i class="fas fa-arrow-left"></i> 返回相簿列表
            </button>
            <h1 id="detailAlbumTitle"></h1>
          </div>

          <label for="mediaUploadInput" class="upload-form-group">
            <i class="fas fa-cloud-upload-alt"></i>
            <p>拖曳或點擊此處上傳圖片或影片</p>
            <input
              type="file"
              id="mediaUploadInput"
              class="upload-file-input"
              multiple
              accept="image/*,video/*"
              onchange="uploadMedia(this.files)"
            />
          </label>

          <div class="media-grid" id="mediaGrid"></div>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="addAlbumModal">
      <div class="modal">
        <div class="modal-header">
          <h2>新增活動相簿</h2>
          <button class="modal-close" onclick="closeModal('addAlbumModal')">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <form
            id="addAlbumForm"
            onsubmit="event.preventDefault(); saveAlbum();"
          >
            <div class="form-group">
              <label for="albumTitle">相簿標題</label>
              <input
                type="text"
                id="albumTitle"
                placeholder="例如：2025年新生營"
                required
              />
            </div>
            <div class="form-group">
              <label for="albumDate">活動日期</label>
              <input type="date" id="albumDate" required />
            </div>
            <div class="form-group">
              <label for="albumDescription">簡要描述</label>
              <textarea
                id="albumDescription"
                placeholder="輸入相簿的簡要描述，例如：三天活動精華"
              ></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-cancel" onclick="closeModal('addAlbumModal')">
            取消
          </button>
          <button class="btn btn-submit" type="submit" form="addAlbumForm">
            新增相簿
          </button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="editAlbumModal">
      <div class="modal">
        <div class="modal-header">
          <h2>修改活動相簿</h2>
          <button class="modal-close" onclick="closeModal('editAlbumModal')">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <form
            id="editAlbumForm"
            onsubmit="event.preventDefault(); updateAlbum();"
          >
            <input type="hidden" id="editAlbumId" />
            <div class="form-group">
              <label for="editAlbumTitle">相簿標題</label>
              <input type="text" id="editAlbumTitle" required />
            </div>
            <div class="form-group">
              <label for="editAlbumDate">活動日期</label>
              <input type="date" id="editAlbumDate" required />
            </div>
            <div class="form-group">
              <label for="editAlbumDescription">簡要描述</label>
              <textarea id="editAlbumDescription"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-cancel" onclick="closeModal('editAlbumModal')">
            取消
          </button>
          <button class="btn btn-submit" type="submit" form="editAlbumForm">
            儲存修改
          </button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="previewModal">
      <div
        class="modal"
        style="
          max-width: 900px;
          padding: 0;
          border-radius: 10px;
          overflow: hidden;
        "
      >
        <div class="modal-header" style="padding: 15px 20px">
          <h2 id="previewTitle" style="font-size: 16px">媒體預覽</h2>
          <button class="modal-close" onclick="closeModal('previewModal')">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body" style="padding: 0; text-align: center">
          <img
            id="previewImage"
            style="
              max-width: 100%;
              max-height: 80vh;
              display: none;
              border-radius: 0 0 10px 10px;
            "
            alt="Preview"
          />
          <video
            id="previewVideo"
            controls
            style="
              max-width: 100%;
              max-height: 80vh;
              display: none;
              border-radius: 0 0 10px 10px;
            "
          ></video>
          <button class="preview-nav-btn preview-prev" onclick="previewPrev()">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button class="preview-nav-btn preview-next" onclick="previewNext()">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>

    <script>
      // 模擬數據庫：相簿列表
      let albumData = [
        {
          id: 1,
          title: "科學營大成功",
          date: "2025-10-07",
          desc: "為期三天的科學營圓滿落幕，收錄了所有精彩的瞬間！感謝所有參與的學生和志工！",
          count: 3,
        },
        {
          id: 2,
          title: "新進志工培訓",
          date: "2025-09-01",
          desc: "新學年志工培訓活動紀錄，期待新血加入！",
          count: 0,
        },
      ];

      // 模擬數據庫：媒體項目 (按相簿 ID 分組)
      let mediaData = {
        1: [
          {
            id: "m1",
            type: "image",
            url: "https://picsum.photos/600/600?random=1",
          },
          {
            id: "m2",
            type: "image",
            url: "https://picsum.photos/600/600?random=2",
          },
          {
            id: "m3",
            type: "image",
            url: "https://picsum.photos/600/600?random=3",
          },
        ],
        2: [],
      };

      let currentAlbumId = null;
      // 預覽所需的狀態
      let previewList = [];
      let previewIndex = -1;

      // --- 視圖切換函數 ---

      function showAlbumDetail(albumId) {
        currentAlbumId = albumId;
        const album = albumData.find((a) => a.id === albumId);
        if (album) {
          document.getElementById("detailAlbumTitle").textContent = album.title;
          document.getElementById("albumListView").style.display = "none";
          document.getElementById("albumDetailView").style.display = "block";
          renderMediaGrid(albumId);
        }
      }

      function showAlbumList() {
        currentAlbumId = null;
        document.getElementById("albumListView").style.display = "block";
        document.getElementById("albumDetailView").style.display = "none";
        closeAllManagementMenus(); // 返回列表時關閉所有選單
      }

      // --- 媒體牆渲染函數 ---

      function renderMediaGrid(albumId) {
        const grid = document.getElementById("mediaGrid");
        grid.innerHTML = "";
        const mediaList = mediaData[albumId] || [];

        if (mediaList.length === 0) {
          grid.innerHTML = `<div style="grid-column: 1 / -1; text-align: center; padding: 50px; color: #999;">
                                  <i class="fas fa-camera" style="font-size: 40px; margin-bottom: 10px; color: #ddd;"></i>
                                  <p>此相簿目前沒有任何媒體項目。</p>
                                </div>`;
          return;
        }

        mediaList.forEach((media) => {
          const item = document.createElement("div");
          item.className = "media-item";

          let mediaElement;
          if (media.type === "image") {
            mediaElement = document.createElement("img");
            mediaElement.src = media.url;
            mediaElement.onclick = () => openPreviewAt(albumId, media.id);
          } else if (media.type === "video") {
            mediaElement = document.createElement("video");
            mediaElement.src = media.url;
            mediaElement.onclick = () => openPreviewAt(albumId, media.id);
          }

          const deleteBtn = document.createElement("button");
          deleteBtn.className = "delete-btn";
          deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i>';
          deleteBtn.onclick = (e) => {
            e.stopPropagation();
            deleteMedia(albumId, media.id);
          };

          item.appendChild(mediaElement);
          item.appendChild(deleteBtn);
          grid.appendChild(item);
        });
      }

      // --- 彈跳視窗控制函數 ---

      function openAddAlbumModal() {
        document.getElementById("addAlbumModal").classList.add("show");
        // 清空表單
        document.getElementById("albumTitle").value = "";
        document.getElementById("albumDate").value = "";
        document.getElementById("albumDescription").value = "";
      }

      function openEditAlbumModal(albumId) {
        const album = albumData.find((a) => a.id === albumId);
        if (!album) return;

        // 填充表單
        document.getElementById("editAlbumId").value = album.id;
        document.getElementById("editAlbumTitle").value = album.title;
        document.getElementById("editAlbumDate").value = album.date;
        document.getElementById("editAlbumDescription").value = album.desc;

        closeAllManagementMenus(); // 關閉管理選單
        document.getElementById("editAlbumModal").classList.add("show");
      }

      function openPreviewAt(albumId, mediaId) {
        // 建立目前相簿的列表與索引
        previewList = (mediaData[albumId] || []).slice();
        previewIndex = previewList.findIndex((m) => m.id === mediaId);
        if (previewIndex < 0) previewIndex = 0;
        currentAlbumId = albumId;
        renderPreview();
        document.getElementById("previewModal").classList.add("show");
      }

      function renderPreview() {
        const img = document.getElementById("previewImage");
        const video = document.getElementById("previewVideo");
        img.style.display = "none";
        video.style.display = "none";
        video.pause();

        if (!previewList.length) return;
        const item = previewList[previewIndex];
        if (item.type === "image") {
          img.src = item.url;
          img.style.display = "block";
          document.getElementById("previewTitle").textContent = "圖片預覽";
        } else if (item.type === "video") {
          video.src = item.url;
          video.style.display = "block";
          document.getElementById("previewTitle").textContent = "影片預覽";
        }
      }

      function previewNext() {
        if (!previewList.length) return;
        previewIndex = (previewIndex + 1) % previewList.length;
        renderPreview();
      }

      function previewPrev() {
        if (!previewList.length) return;
        previewIndex =
          (previewIndex - 1 + previewList.length) % previewList.length;
        renderPreview();
      }

      function closeModal(id) {
        const modal = document.getElementById(id);
        if (modal) {
          modal.classList.remove("show");
          // 如果是預覽視窗，停止播放影片
          if (id === "previewModal") {
            document.getElementById("previewVideo").pause();
            // 清空預覽狀態
            previewList = [];
            previewIndex = -1;
          }
        }
      }

      // --- CRUD 函數 (模擬) ---

      function saveAlbum() {
        const title = document.getElementById("albumTitle").value;
        const date = document.getElementById("albumDate").value;
        const desc = document.getElementById("albumDescription").value;

        if (!title || !date) {
          alert("請填寫相簿標題和日期！");
          return;
        }

        // 模擬新增邏輯
        const newAlbumId =
          albumData.length > 0
            ? Math.max(...albumData.map((a) => a.id)) + 1
            : 1;
        albumData.push({
          id: newAlbumId,
          title: title,
          date: date,
          desc: desc,
          count: 0,
        });
        mediaData[newAlbumId] = []; // 初始化媒體列表

        renderAlbumList();
        closeModal("addAlbumModal");
        alert(`✅ 相簿「${title}」已成功新增！`);
      }

      function updateAlbum() {
        const albumId = parseInt(document.getElementById("editAlbumId").value);
        const title = document.getElementById("editAlbumTitle").value;
        const date = document.getElementById("editAlbumDate").value;
        const desc = document.getElementById("editAlbumDescription").value;

        if (!title || !date) {
          alert("請填寫相簿標題和日期！");
          return;
        }

        const albumIndex = albumData.findIndex((a) => a.id === albumId);
        if (albumIndex > -1) {
          albumData[albumIndex].title = title;
          albumData[albumIndex].date = date;
          albumData[albumIndex].desc = desc;

          renderAlbumList();
          closeModal("editAlbumModal");
          alert(`✅ 相簿「${title}」已成功修改！`);
        }
      }

      function deleteAlbum(albumId) {
        const album = albumData.find((a) => a.id === albumId);
        if (!album) return;

        if (
          confirm(
            `確定要永久刪除相簿「${album.title}」嗎？此操作無法恢復，內含 ${album.count} 個項目！`
          )
        ) {
          // 模擬刪除相簿及其媒體
          albumData = albumData.filter((a) => a.id !== albumId);
          delete mediaData[albumId];

          renderAlbumList();
          closeAllManagementMenus();
          alert(`✅ 相簿「${album.title}」已刪除。`);
        }
      }

      function deleteMedia(albumId, mediaId) {
        if (confirm("確定要刪除此媒體項目嗎？此操作無法恢復！")) {
          const index = mediaData[albumId].findIndex((m) => m.id === mediaId);
          if (index > -1) {
            // 模擬刪除
            const fileUrl = mediaData[albumId][index].url;
            mediaData[albumId].splice(index, 1);
            albumData.find((a) => a.id === albumId).count =
              mediaData[albumId].length;
            renderAlbumList(); // 更新列表計數
            renderMediaGrid(albumId); // 重新渲染媒體牆

            // 清理暫時的 Blob URL
            if (fileUrl.startsWith("blob:")) {
              URL.revokeObjectURL(fileUrl);
            }
            alert("✅ 媒體項目已刪除。");
          }
        }
      }

      // 模擬上傳媒體檔案（管理員功能）
      function uploadMedia(files) {
        if (!currentAlbumId) return alert("錯誤：未選定相簿！");

        const albumId = currentAlbumId;
        const currentMedia = mediaData[albumId];

        const uploadedCount = files.length;
        if (uploadedCount === 0) return;

        let successCount = 0;
        for (let i = 0; i < uploadedCount; i++) {
          const file = files[i];
          const fileType = file.type.startsWith("image/")
            ? "image"
            : file.type.startsWith("video/")
            ? "video"
            : null;

          if (!fileType) {
            console.warn("不支援的檔案類型:", file.type);
            continue;
          }
          successCount++;

          // 模擬檔案上傳：創建一個暫時的 URL 供瀏覽器顯示
          const tempUrl = URL.createObjectURL(file);
          // 使用更穩定的 ID 生成方式
          const newMediaId =
            "m" + Date.now() + Math.random().toString(36).substring(2, 9);

          currentMedia.push({
            id: newMediaId,
            type: fileType,
            url: tempUrl, // 實際應替換為伺服器上的永久 URL
          });
        }

        albumData.find((a) => a.id === albumId).count = currentMedia.length;
        renderAlbumList(); // 更新列表計數
        renderMediaGrid(albumId); // 重新渲染媒體牆
        document.getElementById("mediaUploadInput").value = ""; // 清空檔案選擇器

        if (successCount > 0) {
          alert(`✅ 成功上傳 ${successCount} 個項目到相簿！`);
        } else {
          alert(`⚠️ 沒有可支援的檔案被上傳。`);
        }
      }

      // --- 渲染相簿列表 ---

      function toggleManagementMenu(event, albumId) {
        event.stopPropagation(); // 阻止事件冒泡到卡片點擊事件 (showAlbumDetail)
        closeAllManagementMenus(albumId); // 關閉其他選單

        const menu = document.getElementById(`manage-menu-${albumId}`);
        if (menu) {
          menu.classList.toggle("show");
        }
      }

      function closeAllManagementMenus(excludeId = null) {
        document.querySelectorAll(".album-manage-menu.show").forEach((menu) => {
          const menuId = parseInt(menu.id.replace("manage-menu-", ""));
          if (menuId !== excludeId) {
            menu.classList.remove("show");
          }
        });
      }

      function renderAlbumList() {
        const list = document.getElementById("albumList");
        list.innerHTML = "";
        albumData.forEach((album) => {
          const card = document.createElement("div");
          card.className = "album-card";
          card.setAttribute("data-album-id", album.id);
          // 移除卡片點擊事件，改用一個可點擊的 inner div
          // card.setAttribute('onclick', `showAlbumDetail(${album.id})`);

          const coverStyle =
            album.id === 2
              ? 'style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);"'
              : "";

          // 渲染卡片內容
          card.innerHTML = `
                    <button class="album-manage-btn" onclick="toggleManagementMenu(event, ${album.id})">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <div class="album-manage-menu" id="manage-menu-${album.id}">
                        <a href="javascript:void(0);" onclick="openEditAlbumModal(${album.id})">
                            <i class="fas fa-edit"></i> 修改
                        </a>
                        <a href="javascript:void(0);" class="delete" onclick="deleteAlbum(${album.id})">
                            <i class="fas fa-trash-alt"></i> 刪除
                        </a>
                    </div>
                    
                    <div class="album-card-clickable" onclick="showAlbumDetail(${album.id})">
                        <div class="album-card-cover" ${coverStyle}><i class="fas fa-camera"></i></div>
                        <div class="album-card-info">
                            <div class="album-card-title">${album.title}</div>
                            <div class="album-card-date">
                                <i class="fas fa-calendar-alt"></i> ${album.date}
                                <span style="margin-left:auto; font-size:12px; color:#555;">${album.count} 個項目</span>
                            </div>
                            <div class="album-card-desc">${album.desc}</div>
                        </div>
                    </div>
                `;
          list.appendChild(card);
        });
      }

      // --- 其他工具函數 (側邊選單/通知) ---

      function toggleMenu(element) {
        const parentItem = element.closest(".menu-item");
        const submenu = parentItem.querySelector(".submenu");

        if (parentItem.classList.contains("expanded")) {
          parentItem.classList.remove("expanded");
          submenu.classList.remove("show");
        } else {
          // 關閉其他已展開的選單
          document.querySelectorAll(".menu-item.expanded").forEach((item) => {
            item.classList.remove("expanded");
            item.querySelector(".submenu").classList.remove("show");
          });

          // 展開當前選單
          parentItem.classList.add("expanded");
          submenu.classList.add("show");
        }
      }

      function toggleDropdown() {
        const dropdown = document.getElementById("dropdown");
        dropdown.style.display =
          dropdown.style.display === "block" ? "none" : "block";
        document.getElementById("notificationPanel").style.display = "none"; // 關閉通知面板
        closeAllManagementMenus(); // 關閉相簿管理選單
      }

      function toggleNotificationPanel() {
        const panel = document.getElementById("notificationPanel");
        panel.style.display =
          panel.style.display === "block" ? "none" : "block";
        document.getElementById("dropdown").style.display = "none"; // 關閉登出選單
        closeAllManagementMenus(); // 關閉相簿管理選單
      }

      // 模擬通知數據
      const notifications = [
        {
          id: 1,
          title: "新活動公告",
          text: "「科學之夜」已發佈，請盡快查看！",
          time: "5分鐘前",
          type: "announcement",
          unread: true,
        },
        {
          id: 2,
          title: "志工報名截止",
          text: "最後報名日為今日，請注意時效。",
          time: "1小時前",
          type: "deadline",
          unread: true,
        },
        {
          id: 3,
          title: "活動相簿更新",
          text: "「期末專題展」相簿已新增 15 張照片。",
          time: "1天前",
          type: "activity",
          unread: false,
        },
      ];

      // 頁面加載完成後執行
      document.addEventListener("DOMContentLoaded", () => {
        renderAlbumList();
      });

      // 鍵盤左右鍵導覽預覽
      document.addEventListener("keydown", (e) => {
        const modalVisible = document
          .getElementById("previewModal")
          .classList.contains("show");
        if (!modalVisible) return;
        if (e.key === "ArrowRight") {
          previewNext();
        } else if (e.key === "ArrowLeft") {
          previewPrev();
        }
      });

      // 點擊頁面其他地方關閉選單和通知
      document.addEventListener("click", function (e) {
        // 關閉下拉選單和通知
        if (
          !e.target.closest(".header-right") &&
          !e.target.closest(".modal-overlay")
        ) {
          document.getElementById("dropdown").style.display = "none";
          document.getElementById("notificationPanel").style.display = "none";
        }

        // 關閉相簿管理選單
        if (!e.target.closest(".album-card")) {
          closeAllManagementMenus();
        }

        // 關閉側邊欄子選單
        if (!e.target.closest(".menu")) {
          document.querySelectorAll(".menu-item").forEach((item) => {
            if (!item.querySelector(".menu-link.active")) {
              item.classList.remove("expanded");
              const submenu = item.querySelector(".submenu");
              if (submenu) {
                submenu.classList.remove("show");
              }
            }
          });
        }
      });
    </script>
  </body>
</html>
