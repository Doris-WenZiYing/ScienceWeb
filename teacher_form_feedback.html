<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <title>學生表單反饋 - 老師系統</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <script src="notification-center.js" defer></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        font-family: "Microsoft JhengHei", "Arial", sans-serif;
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      }
      .header {
        height: 70px;
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 30px;
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        position: relative;
        z-index: 100;
      }
      .header::before {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #11998e 0%, #38ef7d 100%);
      }
      .header img.logo {
        height: 50px;
        filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.1));
        transition: transform 0.3s ease;
      }
      .header img.logo:hover {
        transform: scale(1.05);
      }
      .header-right {
        display: flex;
        align-items: center;
        gap: 25px;
        position: relative;
      }
      .icon-wrapper {
        position: relative;
      }
      .icon {
        position: relative;
        padding: 10px;
        border-radius: 50%;
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        transition: all 0.3s ease;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .icon:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(17, 153, 142, 0.5);
      }
      .icon i {
        font-size: 18px;
        color: white;
        animation: bellRing 0.6s ease-in-out infinite;
      }
      @keyframes bellRing {
        0%,
        100% {
          transform: rotate(0deg);
        }
        15% {
          transform: rotate(15deg);
        }
        30% {
          transform: rotate(-15deg);
        }
        45% {
          transform: rotate(10deg);
        }
        60% {
          transform: rotate(-10deg);
        }
        75% {
          transform: rotate(5deg);
        }
      }
      .notification-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background: linear-gradient(135deg, #ff4757 0%, #ff6348 100%);
        color: white;
        border-radius: 50%;
        width: 26px;
        height: 26px;
        font-size: 12px;
        display: none;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        border: 2px solid white;
        box-shadow: 0 4px 12px rgba(255, 71, 87, 0.5);
        animation: badgePulse 2s infinite;
      }
      .notification-badge.active {
        display: flex;
      }
      @keyframes badgePulse {
        0%,
        100% {
          transform: scale(1);
          box-shadow: 0 4px 12px rgba(255, 71, 87, 0.5);
        }
        50% {
          transform: scale(1.2);
          box-shadow: 0 6px 20px rgba(255, 71, 87, 0.8);
        }
      }
      .notification-panel {
        position: absolute;
        top: 65px;
        right: 0;
        background: white;
        border-radius: 15px;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
        display: none;
        width: 400px;
        max-height: 550px;
        z-index: 1001;
        overflow: hidden;
        animation: panelFade 0.3s ease;
        flex-direction: column;
      }
      @keyframes panelFade {
        from {
          opacity: 0;
          transform: translateY(-15px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      .notification-panel.active {
        display: flex;
      }
      .notification-header {
        padding: 20px 25px;
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
      }
      .notification-header h3 {
        font-size: 17px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .notification-header i {
        font-size: 20px;
      }
      .mark-all-read {
        background: rgba(255, 255, 255, 0.25);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 7px 14px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 600;
        transition: all 0.3s ease;
      }
      .mark-all-read:hover {
        background: rgba(255, 255, 255, 0.35);
        border-color: rgba(255, 255, 255, 0.5);
        transform: translateY(-2px);
      }
      .notification-list {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
      }
      .notification-item {
        padding: 16px;
        margin-bottom: 8px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        background: #f8f9fa;
        border-left: 4px solid transparent;
        position: relative;
      }
      .notification-item:hover {
        background: #f0f1f2;
        transform: translateX(4px);
      }
      .notification-item.unread {
        background: linear-gradient(135deg, #e8f9f8 0%, #f0fffe 100%);
        border-left-color: #11998e;
        box-shadow: 0 2px 8px rgba(17, 153, 142, 0.15);
      }
      .notification-item.unread::after {
        content: "";
        position: absolute;
        top: 8px;
        right: 8px;
        width: 10px;
        height: 10px;
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        border-radius: 50%;
        animation: unreadPulse 2s infinite;
      }
      @keyframes unreadPulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.2);
          opacity: 0.8;
        }
      }
      .notification-item-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
      }
      .notification-item-title {
        font-weight: 700;
        color: #333;
        flex: 1;
        margin-right: 10px;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .notification-type-icon {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        color: white;
        flex-shrink: 0;
      }
      .notification-type-icon.info {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      }
      .notification-type-icon.warning {
        background: linear-gradient(135deg, #ff9800 0%, #ffc107 100%);
      }
      .notification-item-time {
        font-size: 12px;
        color: #999;
        white-space: nowrap;
      }
      .notification-item-message {
        font-size: 13px;
        color: #666;
        line-height: 1.5;
        margin-bottom: 10px;
        font-weight: 500;
      }
      .notification-actions {
        display: flex;
        gap: 8px;
      }
      .notification-btn {
        font-size: 11px;
        padding: 6px 12px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 4px;
      }
      .notification-btn-read {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        box-shadow: 0 2px 8px rgba(17, 153, 142, 0.2);
      }
      .notification-btn-read:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(17, 153, 142, 0.4);
      }
      .notification-btn-clear {
        background: #ffe8e8;
        color: #d32f2f;
        box-shadow: 0 2px 8px rgba(211, 47, 47, 0.1);
      }
      .notification-btn-clear:hover {
        background: #ffcccb;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(211, 47, 47, 0.2);
      }
      .empty-notification {
        padding: 50px 20px;
        text-align: center;
        color: #999;
      }
      .empty-notification i {
        font-size: 45px;
        margin-bottom: 15px;
        opacity: 0.4;
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      .empty-notification p {
        font-weight: 600;
        font-size: 14px;
      }
      .avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 3px solid #fff;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }
      .avatar:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(17, 153, 142, 0.3);
      }
      .avatar i {
        font-size: 20px;
        color: white;
      }
      .dropdown {
        position: absolute;
        top: 65px;
        right: 0;
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        display: none;
        min-width: 120px;
        z-index: 1000;
        overflow: hidden;
        animation: dropdownFade 0.3s ease;
      }
      @keyframes dropdownFade {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .dropdown a {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        text-decoration: none;
        color: #333;
        font-size: 14px;
        transition: all 0.2s ease;
      }
      .dropdown a:hover {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
      }
      .dropdown a i {
        margin-right: 8px;
        width: 16px;
      }
      .main {
        display: flex;
        height: calc(100% - 70px);
        gap: 0;
      }
      .sidebar {
        width: 250px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 30px 0;
        display: flex;
        flex-direction: column;
        box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
        position: relative;
      }
      .sidebar::before {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(180deg, #11998e 0%, #38ef7d 100%);
      }
      .sidebar h2 {
        font-size: 16px;
        margin: 0 0 0 0;
        padding: 18px 30px;
        color: #555;
        font-weight: 400;
        text-align: left;
        position: relative;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 15px;
        border-left: 4px solid transparent;
      }
      .sidebar h2 i {
        font-size: 17px;
        color: #555;
        width: 20px;
        text-align: center;
      }
      .sidebar h2:hover {
        color: #11998e;
        background: rgba(17, 153, 142, 0.1);
        border-left: 4px solid #11998e;
        transform: translateX(5px);
      }
      .sidebar h2:hover i {
        color: #11998e;
      }
      .menu a {
        display: flex;
        align-items: center;
        padding: 18px 30px;
        text-decoration: none;
        color: #555;
        font-size: 16px;
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
        position: relative;
      }
      .menu a:hover,
      .menu a.active {
        color: #11998e;
        background: rgba(17, 153, 142, 0.1);
        border-left: 4px solid #11998e;
        transform: translateX(5px);
      }
      .menu a i {
        margin-right: 15px;
        width: 20px;
        font-size: 18px;
      }
      .content {
        flex: 1;
        padding: 40px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        display: flex;
        flex-direction: column;
        overflow-y: auto;
      }
      .feedback-container {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 20px;
        padding: 30px;
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      }
      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
        gap: 15px;
      }
      .page-title {
        font-size: 28px;
        color: #333;
        font-weight: 300;
        display: flex;
        align-items: center;
      }
      .page-title i {
        margin-right: 15px;
        color: #11998e;
        font-size: 32px;
      }
      .header-time {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        padding: 10px 20px;
        border-radius: 25px;
        font-size: 14px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 2px 10px rgba(17, 153, 142, 0.3);
      }
      .header-time i {
        font-size: 16px;
      }
      .feedback-filter {
        background: rgba(248, 249, 250, 0.8);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        align-items: center;
      }
      .filter-group {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .filter-label {
        font-weight: 600;
        color: #333;
        font-size: 14px;
      }
      .filter-select,
      .filter-input {
        padding: 10px 15px;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        font-size: 14px;
        transition: all 0.3s ease;
        background: white;
      }
      .filter-select:focus,
      .filter-input:focus {
        outline: none;
        border-color: #11998e;
        box-shadow: 0 0 0 3px rgba(17, 153, 142, 0.1);
      }
      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      .btn-primary {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(17, 153, 142, 0.3);
      }
      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(17, 153, 142, 0.4);
      }
      .btn-secondary {
        background: #6c757d;
        color: white;
      }
      .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
      }
      .feedback-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      .stat-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        text-align: center;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #11998e 0%, #38ef7d 100%);
      }
      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }
      .stat-icon {
        font-size: 36px;
        margin-bottom: 15px;
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      .stat-number {
        font-size: 28px;
        font-weight: bold;
        margin-bottom: 10px;
        color: #333;
      }
      .stat-label {
        color: #666;
        font-size: 14px;
        font-weight: 600;
      }
      .feedback-list {
        display: grid;
        gap: 20px;
      }
      .feedback-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      .feedback-card::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        width: 5px;
        height: 100%;
        background: linear-gradient(180deg, #11998e 0%, #38ef7d 100%);
      }
      .feedback-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }
      .feedback-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
        flex-wrap: wrap;
        gap: 10px;
      }
      .feedback-info {
        flex: 1;
      }
      .student-name {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
      }
      .activity-name {
        font-size: 14px;
        color: #11998e;
        font-weight: 500;
      }
      .feedback-meta {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 5px;
      }
      .feedback-date {
        font-size: 12px;
        color: #666;
      }
      .rating-display {
        display: flex;
        align-items: center;
        gap: 5px;
      }
      .stars {
        color: #ffc107;
        font-size: 16px;
      }
      .rating-text {
        font-size: 14px;
        color: #666;
        font-weight: 600;
      }
      .feedback-content {
        margin: 20px 0;
      }
      .feedback-section {
        margin-bottom: 15px;
      }
      .section-title {
        font-size: 14px;
        font-weight: 600;
        color: #11998e;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
      }
      .section-title i {
        margin-right: 8px;
        width: 16px;
      }
      .section-content {
        font-size: 14px;
        color: #666;
        line-height: 1.6;
        background: rgba(248, 249, 250, 0.8);
        padding: 12px 15px;
        border-radius: 8px;
      }
      .feedback-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 15px;
      }
      .tag {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: 500;
      }
      .feedback-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid #e9ecef;
      }
      .btn-sm {
        padding: 8px 16px;
        font-size: 12px;
      }
      .btn-info {
        background: linear-gradient(135deg, #17a2b8 0%, #20c997 100%);
        color: white;
      }
      .btn-success {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
      }
      .btn-warning {
        background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
        color: white;
      }
      .btn-sm:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }
      .empty-state {
        text-align: center;
        padding: 80px 20px;
        color: #666;
      }
      .empty-icon {
        font-size: 64px;
        color: rgba(17, 153, 142, 0.3);
        margin-bottom: 20px;
      }
      .empty-title {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 10px;
      }
      .empty-description {
        font-size: 16px;
        opacity: 0.8;
      }
      .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
      }
      .status-unread {
        background: rgba(255, 193, 7, 0.1);
        color: #ffc107;
      }
      .status-read {
        background: rgba(23, 162, 184, 0.1);
        color: #17a2b8;
      }
      .status-replied {
        background: rgba(40, 167, 69, 0.1);
        color: #28a745;
      }
      @media (max-width: 768px) {
        .main {
          flex-direction: column;
        }
        .sidebar {
          width: 100%;
          height: auto;
        }
        .menu {
          display: flex;
          overflow-x: auto;
        }
        .menu a {
          white-space: nowrap;
          padding: 15px 20px;
        }
        .content {
          padding: 20px;
        }
        .feedback-filter {
          flex-direction: column;
          align-items: stretch;
        }
        .filter-group {
          flex-direction: column;
          align-items: stretch;
          gap: 8px;
        }
        .feedback-stats {
          grid-template-columns: repeat(2, 1fr);
        }
        .page-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 15px;
        }
        .header-time {
          align-self: stretch;
          justify-content: center;
          font-size: 12px;
          padding: 8px 15px;
        }
        .feedback-header {
          flex-direction: column;
          align-items: stretch;
        }
        .feedback-meta {
          flex-direction: row;
          justify-content: space-between;
          align-items: center;
        }
        .notification-panel {
          width: 320px;
        }
      }
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1);
      }
      ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #38ef7d 0%, #11998e 100%);
      }
    </style>
  </head>
  <body class="teacher-page">
    <div class="header">
      <a href="teacher_dashboard.html">
        <img src="image/logo1.gif" alt="Logo" class="logo" />
      </a>
      <div class="header-right">
        <div class="icon-wrapper">
          <div class="icon" id="notificationBell">
            <i class="fas fa-bell"></i>
          </div>
          <div class="notification-badge" id="notificationBadge">0</div>
        </div>
        <div class="notification-panel" id="notificationPanel">
          <div class="notification-header">
            <h3><i class="fas fa-bell"></i> 通知中心</h3>
            <button class="mark-all-read">
              <i class="fas fa-check-double"></i> 全部已讀
            </button>
          </div>
          <div class="notification-list" id="notificationList">
            <div class="empty-notification">
              <i class="fas fa-inbox"></i>
              <p>沒有通知</p>
            </div>
          </div>
        </div>
        <div class="avatar" id="avatar">
          <i class="fas fa-user"></i>
        </div>
        <div class="dropdown" id="dropdown">
          <a href="login_teacher.html">
            <i class="fas fa-sign-out-alt"></i>
            登出
          </a>
        </div>
      </div>
    </div>

    <div class="main">
      <div class="sidebar">
        <h2 onclick="location.href='teacher_dashboard.html';">
          <i class="fas fa-home"></i>
          老師首頁
        </h2>
        <div class="menu">
          <a href="teacher_activity_status.html">
            <i class="fas fa-chart-bar"></i>
            查看活動情況
          </a>
          <a href="teacher_registration_statistics.html">
            <i class="fas fa-users"></i>
            報名數據統計
          </a>
          <a href="form_feedback.html" class="active">
            <i class="fas fa-comments"></i>
            學生表單反饋
          </a>
          <a href="teacher_schedules_classes.html">
            <i class="fas fa-calendar-alt"></i>
            線上排班
          </a>
          <a href="teacher_ask_for_leave.html">
            <i class="fas fa-clipboard-check"></i>
            請假審核
          </a>
          <a href="teacher_rollcall.html">
            <i class="fas fa-user-check"></i>
            點名系統
          </a>
          <a href="working_hours.html">
            <i class="fas fa-clock"></i>
            工作時數與出席記錄
          </a>
        </div>
      </div>

      <div class="content">
        <div class="feedback-container">
          <div class="page-header">
            <div class="page-title">
              <i class="fas fa-comment-dots"></i>
              學生表單反饋
            </div>
            <div class="header-time" id="currentTime">
              <i class="fas fa-clock"></i>
              <span id="timeText"></span>
            </div>
          </div>

          <div class="feedback-filter">
            <div class="filter-group">
              <label class="filter-label">活動篩選：</label>
              <select class="filter-select" id="activityFilter">
                <option value="">全部活動</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">評分篩選：</label>
              <select class="filter-select" id="ratingFilter">
                <option value="">全部評分</option>
                <option value="5">⭐⭐⭐⭐⭐ (5分)</option>
                <option value="4">⭐⭐⭐⭐ (4分以上)</option>
                <option value="3">⭐⭐⭐ (3分以上)</option>
                <option value="2">⭐⭐ (2分以上)</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">時間範圍：</label>
              <input type="date" class="filter-input" id="startDate" />
              <span style="color: #666">至</span>
              <input type="date" class="filter-input" id="endDate" />
            </div>
            <button class="btn btn-primary" onclick="filterFeedback()">
              <i class="fas fa-filter"></i>
              篩選
            </button>
            <button class="btn btn-secondary" onclick="resetFilters()">
              <i class="fas fa-redo"></i>
              重設
            </button>
          </div>

          <div class="feedback-stats">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-comment"></i>
              </div>
              <div class="stat-number" id="totalFeedback">0</div>
              <div class="stat-label">總反饋數</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-star"></i>
              </div>
              <div class="stat-number" id="avgRating">0</div>
              <div class="stat-label">平均評分</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-thumbs-up"></i>
              </div>
              <div class="stat-number" id="positiveRate">0%</div>
              <div class="stat-label">正面評價率</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-envelope-open"></i>
              </div>
              <div class="stat-number" id="unreadCount">0</div>
              <div class="stat-label">未讀反饋</div>
            </div>
          </div>

          <div class="feedback-list" id="feedbackList">
            <div class="empty-state">
              <div class="empty-icon">
                <i class="fas fa-spinner fa-spin"></i>
              </div>
              <div class="empty-title">載入中...</div>
              <div class="empty-description">正在獲取學生反饋資料</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const API_BASE_URL = "teacher_api.php";
      let allFeedback = [];
      let filteredFeedback = [];

      // 狀態映射
      const statusMap = {
        0: { text: "未讀", class: "status-unread", icon: "fa-envelope" },
        1: { text: "已讀", class: "status-read", icon: "fa-envelope-open" },
        replied: {
          text: "已回覆",
          class: "status-replied",
          icon: "fa-check-circle",
        },
      };

      // 初始化
      window.addEventListener("load", () => {
        updateTime();
        setInterval(updateTime, 1000);
        initializeDates();
        loadFeedback();
      });

      // 時間顯示
      function updateTime() {
        const now = new Date();
        const options = {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
          weekday: "long",
        };
        document.getElementById("timeText").textContent =
          now.toLocaleDateString("zh-TW", options);
      }

      // 初始化日期
      function initializeDates() {
        const today = new Date();
        const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
        document.getElementById("startDate").valueAsDate = firstDay;
        document.getElementById("endDate").valueAsDate = today;
      }

      // 載入反饋列表
      async function loadFeedback() {
        try {
          const response = await fetch(
            `${API_BASE_URL}?action=get_feedback_list`
          );
          const result = await response.json();

          if (Array.isArray(result)) {
            allFeedback = result;
            filteredFeedback = [...allFeedback];

            // 載入活動選項
            loadActivityOptions();

            // 渲染列表
            renderFeedback();
            updateStats();
          } else {
            throw new Error("無效的資料格式");
          }
        } catch (error) {
          console.error("載入反饋失敗:", error);
          showEmptyState("無法載入反饋資料", "請稍後再試或聯繫系統管理員");
        }
      }

      // 載入活動選項
      function loadActivityOptions() {
        const activityFilter = document.getElementById("activityFilter");
        const activities = [
          ...new Set(allFeedback.map((f) => f.activity_name)),
        ];

        activities.forEach((activity) => {
          const option = document.createElement("option");
          option.value = activity;
          option.textContent = activity;
          activityFilter.appendChild(option);
        });
      }

      // 渲染反饋列表
      function renderFeedback() {
        const feedbackList = document.getElementById("feedbackList");
        feedbackList.innerHTML = "";

        if (filteredFeedback.length === 0) {
          showEmptyState(
            "暫無符合條件的反饋",
            "請嘗試調整篩選條件或等待新的學生反饋"
          );
          return;
        }

        filteredFeedback.forEach((feedback) => {
          const isRead = feedback.is_read == 1;
          const statusInfo = statusMap[feedback.is_read] || statusMap["0"];
          const stars =
            "★".repeat(feedback.satisfaction_score || 0) +
            "☆".repeat(5 - (feedback.satisfaction_score || 0));

          const feedbackCard = document.createElement("div");
          feedbackCard.className = "feedback-card";
          feedbackCard.innerHTML = `
          <div class="feedback-header">
            <div class="feedback-info">
              <div class="student-name">${
                feedback.student_name || "匿名學生"
              }</div>
              <div class="activity-name">${
                feedback.activity_name || "未指定活動"
              }</div>
            </div>
            <div class="feedback-meta">
              <div class="feedback-date">${formatDate(
                feedback.submitted_at
              )}</div>
              <div class="rating-display">
                <div class="stars">${stars}</div>
                <div class="rating-text">${
                  feedback.satisfaction_score || 0
                }/5</div>
              </div>
            </div>
          </div>
          
          <div class="feedback-content">
            <div class="feedback-section">
              <div class="section-title">
                <i class="fas fa-heart"></i>
                學生反饋
              </div>
              <div class="section-content">${
                feedback.feedback_text || "無文字反饋"
              }</div>
            </div>
          </div>
          
          <div class="feedback-actions">
            <span class="status-badge ${statusInfo.class}">
              <i class="fas ${statusInfo.icon}"></i>
              ${statusInfo.text}
            </span>
            ${
              !isRead
                ? `
              <button class="btn btn-info btn-sm" onclick="markFeedbackAsRead(${feedback.response_id})">
                <i class="fas fa-check"></i>
                標記已讀
              </button>
            `
                : ""
            }
            <button class="btn btn-success btn-sm" onclick="viewDetails(${
              feedback.response_id
            })">
              <i class="fas fa-eye"></i>
              查看詳情
            </button>
          </div>
        `;

          feedbackList.appendChild(feedbackCard);
        });
      }

      // 顯示空狀態
      function showEmptyState(title, description) {
        const feedbackList = document.getElementById("feedbackList");
        feedbackList.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">
            <i class="fas fa-comments"></i>
          </div>
          <div class="empty-title">${title}</div>
          <div class="empty-description">${description}</div>
        </div>
      `;
      }

      // 篩選反饋
      function filterFeedback() {
        const activityFilter = document.getElementById("activityFilter").value;
        const ratingFilter = document.getElementById("ratingFilter").value;
        const startDate = document.getElementById("startDate").value;
        const endDate = document.getElementById("endDate").value;

        filteredFeedback = allFeedback.filter((feedback) => {
          const matchesActivity =
            !activityFilter || feedback.activity_name === activityFilter;
          const matchesRating =
            !ratingFilter ||
            feedback.satisfaction_score >= parseInt(ratingFilter);
          const feedbackDate = feedback.submitted_at
            ? feedback.submitted_at.split(" ")[0]
            : "";
          const matchesDateRange =
            (!startDate || feedbackDate >= startDate) &&
            (!endDate || feedbackDate <= endDate);

          return matchesActivity && matchesRating && matchesDateRange;
        });

        renderFeedback();
        updateStats();
        showNotification("篩選已更新", "success");
      }

      // 重設篩選器
      function resetFilters() {
        document.getElementById("activityFilter").value = "";
        document.getElementById("ratingFilter").value = "";
        initializeDates();
        filteredFeedback = [...allFeedback];
        renderFeedback();
        updateStats();
        showNotification("篩選已重設", "info");
      }

      // 更新統計數據
      function updateStats() {
        const totalFeedback = filteredFeedback.length;
        const avgRating =
          totalFeedback > 0
            ? (
                filteredFeedback.reduce(
                  (sum, f) => sum + (f.satisfaction_score || 0),
                  0
                ) / totalFeedback
              ).toFixed(1)
            : 0;
        const positiveRate =
          totalFeedback > 0
            ? Math.round(
                (filteredFeedback.filter(
                  (f) => (f.satisfaction_score || 0) >= 4
                ).length /
                  totalFeedback) *
                  100
              )
            : 0;
        const unreadCount = filteredFeedback.filter(
          (f) => f.is_read == 0
        ).length;

        animateNumber("totalFeedback", totalFeedback);
        animateNumber("avgRating", avgRating);
        animateNumber("positiveRate", positiveRate, "%");
        animateNumber("unreadCount", unreadCount);
      }

      // 數字動畫效果
      function animateNumber(elementId, targetValue, suffix = "") {
        const element = document.getElementById(elementId);
        const startValue = parseFloat(element.textContent) || 0;
        const increment = (targetValue - startValue) / 20;
        let currentValue = startValue;

        const timer = setInterval(() => {
          currentValue += increment;
          if (
            (increment > 0 && currentValue >= targetValue) ||
            (increment < 0 && currentValue <= targetValue) ||
            increment === 0
          ) {
            element.textContent = targetValue + suffix;
            clearInterval(timer);
          } else {
            element.textContent =
              (elementId === "avgRating"
                ? currentValue.toFixed(1)
                : Math.floor(currentValue)) + suffix;
          }
        }, 50);
      }

      // 標記反饋為已讀
      async function markFeedbackAsRead(responseId) {
        try {
          const formData = new FormData();
          formData.append("action", "mark_feedback_read");
          formData.append("response_id", responseId);

          const response = await fetch(API_BASE_URL, {
            method: "POST",
            body: formData,
          });

          const result = await response.json();

          if (result.success) {
            // 更新本地數據
            const feedback = allFeedback.find(
              (f) => f.response_id == responseId
            );
            if (feedback) {
              feedback.is_read = 1;
            }

            renderFeedback();
            updateStats();
            showNotification("已標記為已讀", "success");
          } else {
            showNotification(result.message || "操作失敗", "error");
          }
        } catch (error) {
          console.error("標記已讀失敗:", error);
          showNotification("操作失敗，請稍後再試", "error");
        }
      }

      // 查看詳細資訊
      function viewDetails(responseId) {
        const feedback = allFeedback.find((f) => f.response_id == responseId);
        if (feedback) {
          alert(
            `學生：${feedback.student_name || "匿名"}\n班級：${
              feedback.student_class || "未提供"
            }\n活動：${feedback.activity_name || "未指定"}\n評分：${
              feedback.satisfaction_score || 0
            }/5\n提交時間：${formatDate(
              feedback.submitted_at
            )}\n\n反饋內容：\n${feedback.feedback_text || "無文字反饋"}`
          );
        }
      }

      // 格式化日期
      function formatDate(dateString) {
        if (!dateString) return "未知日期";
        const date = new Date(dateString);
        return date.toLocaleDateString("zh-TW", {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      // 格式化相對時間
      function formatTimeAgo(dateString) {
        if (!dateString) return "剛剛";
        const date = new Date(dateString);
        const now = new Date();
        const diff = now - date;
        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(diff / 3600000);
        const days = Math.floor(diff / 86400000);

        if (minutes < 1) return "剛剛";
        if (minutes < 60) return `${minutes}分鐘前`;
        if (hours < 24) return `${hours}小時前`;
        if (days < 7) return `${days}天前`;
        return date.toLocaleDateString("zh-TW");
      }

      // 顯示通知訊息
      function showNotification(message, type = "info") {
        const notification = document.createElement("div");
        notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${
          type === "success"
            ? "linear-gradient(135deg, #28a745 0%, #20c997 100%)"
            : type === "error"
            ? "linear-gradient(135deg, #dc3545 0%, #e83e8c 100%)"
            : "linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%)"
        };
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        z-index: 10000;
        font-weight: 500;
        animation: slideIn 0.3s ease;
        cursor: pointer;
      `;
        notification.textContent = message;

        notification.addEventListener("click", () => {
          notification.style.animation = "slideOut 0.3s ease";
          setTimeout(() => notification.remove(), 300);
        });

        if (!document.querySelector("#notificationStyles")) {
          const style = document.createElement("style");
          style.id = "notificationStyles";
          style.textContent = `
          @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
          @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
          }
        `;
          document.head.appendChild(style);
        }

        document.body.appendChild(notification);

        setTimeout(() => {
          if (notification.parentNode) {
            notification.style.animation = "slideOut 0.3s ease";
            setTimeout(() => notification.remove(), 300);
          }
        }, 3000);
      }
    </script>
  </body>
</html>
