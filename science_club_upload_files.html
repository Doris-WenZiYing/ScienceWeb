<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>科學會管理系統-開放上傳檔案</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <script src="notification-center.js" defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

      html,
      body {
        height: 100%;
        width: 100%;
        font-family: "Microsoft JhengHei", "Arial", sans-serif;
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        overflow: hidden;
      }

        .header {
            height: 70px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 100;
        }

      .icon-wrapper {
        position: relative;
      }

      .header::before {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #8360c3 0%, #2ebf91 100%);
      }

      .header-left {
        display: flex;
        align-items: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .header-left:hover {
        transform: scale(1.02);
      }

      .header img.logo {
        height: 50px;
        filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.1));
        transition: transform 0.3s ease;
        margin-right: 15px;
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 25px;
        position: relative;
      }

      .icon {
        position: relative;
        padding: 12px;
        border-radius: 50%;
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(131, 96, 195, 0.3);
        border: 2px solid rgba(255, 255, 255, 0.2);
        animation: pulse 2s infinite;
      }

      .icon:hover {
        transform: translateY(-3px) scale(1.1);
        box-shadow: 0 12px 35px rgba(131, 96, 195, 0.5);
        background: linear-gradient(135deg, #9d7ce6 0%, #3dd5a3 100%);
      }

      .icon i {
        font-size: 20px;
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        animation: bellShake 0.5s ease-in-out infinite alternate;
      }

      .icon::after {
        position: absolute;
        top: -5px;
        right: -5px;
        background: linear-gradient(135deg, #ff4757 0%, #ff3742 100%);
        color: white;
        border-radius: 50%;
        width: 22px;
        height: 22px;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        box-shadow: 0 2px 8px rgba(255, 71, 87, 0.4);
        border: 2px solid white;
        animation: bounce 1s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          box-shadow: 0 4px 15px rgba(131, 96, 195, 0.3);
        }
        50% {
          box-shadow: 0 4px 25px rgba(131, 96, 195, 0.6);
        }
      }

      @keyframes bellShake {
        0% {
          transform: rotate(-5deg);
        }
        100% {
          transform: rotate(5deg);
        }
      }

      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-3px);
        }
        60% {
          transform: translateY(-2px);
        }
      }

      .avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 3px solid #fff;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .avatar:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(131, 96, 195, 0.3);
      }

        .avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #fff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

      .dropdown {
        position: absolute;
        top: 65px;
        right: 0;
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        display: none;
        min-width: 120px;
        z-index: 1000;
        overflow: hidden;
        animation: dropdownFade 0.3s ease;
      }

      @keyframes dropdownFade {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .dropdown a {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        text-decoration: none;
        color: #333;
        font-size: 14px;
        transition: all 0.2s ease;
      }

      .dropdown a:hover {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        color: white;
      }

      .dropdown a i {
        margin-right: 8px;
        width: 16px;
      }

      .notification-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background: linear-gradient(135deg, #ff4757 0%, #ff6348 100%);
        color: white;
        border-radius: 50%;
        width: 26px;
        height: 26px;
        font-size: 12px;
        display: none;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        border: 2px solid white;
        box-shadow: 0 4px 12px rgba(255, 71, 87, 0.5);
        animation: badgePulse 2s infinite;
      }
      .notification-badge.active {
        display: flex;
      }
      @keyframes badgePulse {
        0%,
        100% {
          transform: scale(1);
          box-shadow: 0 4px 12px rgba(255, 71, 87, 0.5);
        }
        50% {
          transform: scale(1.2);
          box-shadow: 0 6px 20px rgba(255, 71, 87, 0.8);
        }
      }
      .notification-panel {
        position: absolute;
        top: 65px;
        right: 0;
        background: white;
        border-radius: 15px;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
        display: none;
        width: 400px;
        max-height: 550px;
        z-index: 1001;
        overflow: hidden;
        animation: panelFade 0.3s ease;
        flex-direction: column;
      }
      @keyframes panelFade {
        from {
          opacity: 0;
          transform: translateY(-15px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      .notification-panel.active {
        display: flex;
      }
      .notification-header {
        padding: 20px 25px;
        border-bottom: 2px solid #f0f0f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
      }
      .notification-header h3 {
        font-size: 18px;
        color: white;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .mark-all-read {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        padding: 8px 15px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 13px;
        color: white;
        font-weight: 500;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
      }
      .mark-all-read:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }
      .notification-list {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
      }
      .notification-list::-webkit-scrollbar {
        width: 6px;
      }
      .notification-list::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }
      .notification-list::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        border-radius: 10px;
      }
      .notification-item {
        background: white;
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 12px;
        border: 1px solid #e8e8e8;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }
      .notification-item::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        transform: scaleY(0);
        transition: transform 0.3s ease;
      }
      .notification-item:hover {
        transform: translateX(5px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        border-color: #8360c3;
      }
      .notification-item:hover::before {
        transform: scaleY(1);
      }
      .notification-item.unread {
        background: linear-gradient(
          135deg,
          rgba(131, 96, 195, 0.05) 0%,
          rgba(46, 191, 145, 0.05) 100%
        );
        border-left: 4px solid #8360c3;
        font-weight: 500;
      }
      .notification-item-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 8px;
        gap: 10px;
      }
      .notification-item-title {
        font-size: 15px;
        color: #2c3e50;
        font-weight: 600;
        flex: 1;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .notification-type-icon {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }
      .notification-type-icon.info {
        background: linear-gradient(
          135deg,
          rgba(131, 96, 195, 0.2) 0%,
          rgba(46, 191, 145, 0.2) 100%
        );
        color: #8360c3;
      }
      .notification-type-icon i {
        font-size: 14px;
      }
      .notification-item-time {
        font-size: 12px;
        color: #95a5a6;
        white-space: nowrap;
      }
      .notification-item-message {
        font-size: 13px;
        color: #7f8c8d;
        line-height: 1.5;
        margin-bottom: 10px;
      }
      .notification-actions {
        display: flex;
        gap: 8px;
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid #f0f0f0;
      }
      .notification-btn {
        flex: 1;
        padding: 8px 12px;
        border: none;
        border-radius: 8px;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        font-weight: 500;
      }
      .notification-btn-read {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        color: white;
      }
      .notification-btn-read:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(131, 96, 195, 0.4);
      }
      .notification-btn-clear {
        background: #ecf0f1;
        color: #7f8c8d;
      }
      .notification-btn-clear:hover {
        background: #e74c3c;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(231, 76, 60, 0.3);
      }
      .empty-notification {
        text-align: center;
        padding: 60px 20px;
        color: #95a5a6;
      }
      .empty-notification i {
        font-size: 64px;
        margin-bottom: 20px;
        opacity: 0.3;
      }
      .empty-notification p {
        font-size: 16px;
        font-weight: 500;
      }

      .main {
        height: calc(100% - 70px);
        display: flex;
        overflow: hidden;
      }
      .sidebar {
        width: 280px;
        background: #ffffff;
        overflow-y: auto;
        flex-shrink: 0;
        transition: width 0.3s ease, opacity 0.3s ease;
        box-shadow: 2px 0 15px rgba(0, 0, 0, 0.05);
      }
      .sidebar::-webkit-scrollbar {
        width: 6px;
      }
      .sidebar::-webkit-scrollbar-track {
        background: #f8f9fa;
        border-radius: 10px;
      }
      .sidebar::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        border-radius: 10px;
      }
      .menu {
        padding: 15px 0;
      }
      .menu-item {
        margin-bottom: 4px;
        position: relative;
      }
      .menu-link,
      .submenu-link {
        display: flex;
        align-items: center;
        padding: 14px 25px;
        text-decoration: none;
        color: #5a6c7d;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 500;
        font-size: 14px;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }
      .menu-link:hover,
      .submenu-link:hover {
        background: linear-gradient(
          90deg,
          rgba(131, 96, 195, 0.08) 0%,
          rgba(46, 191, 145, 0.08) 100%
        );
        color: #8360c3;
        padding-left: 30px;
      }
      .menu-link.active {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        color: #ffffff;
        font-weight: 600;
        box-shadow: 0 2px 10px rgba(131, 96, 195, 0.3);
      }
      .menu-link.active:hover {
        padding-left: 25px;
      }
      .menu-link i,
      .submenu-link i {
        margin-right: 12px;
        width: 18px;
        text-align: center;
        font-size: 16px;
      }
      .menu-arrow {
        margin-left: auto;
        transition: transform 0.3s ease;
        font-size: 12px;
      }
      .menu-item.expanded .menu-arrow {
        transform: rotate(180deg);
      }
      .submenu {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        background: #f8f9fa;
      }
      .menu-item.expanded .submenu {
        max-height: 500px;
      }
      .submenu-item {
        padding-left: 20px;
      }
      .submenu-link {
        padding: 12px 25px;
        font-size: 13px;
      }
      .content {
        flex: 1;
        padding: 30px;
        overflow-y: auto;
        background: rgba(255, 255, 255, 0.08);
      }
      .content::-webkit-scrollbar {
        width: 8px;
      }
      .content::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
      }
      .content::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.3);
        border-radius: 10px;
      }
      .page-header {
        background: white;
        padding: 24px 30px;
        border-radius: 15px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
        margin-bottom: 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .page-title-section h1 {
        font-size: 28px;
        font-weight: 700;
        color: #2c3e50;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .page-title-section h1 i {
        color: #8360c3;
      }
      .header-actions {
        display: flex;
        gap: 15px;
        align-items: center;
      }
      .create-zone-btn {
        padding: 12px 24px;
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 4px 15px rgba(131, 96, 195, 0.3);
      }
      .create-zone-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(131, 96, 195, 0.4);
      }
      .current-time {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 16px;
        background: linear-gradient(
          135deg,
          rgba(131, 96, 195, 0.1) 0%,
          rgba(46, 191, 145, 0.1) 100%
        );
        border-radius: 10px;
        color: #5a6c7d;
        font-size: 13px;
        font-weight: 500;
      }
      .current-time i {
        color: #8360c3;
        font-size: 14px;
      }
      .success-message {
        display: none;
        align-items: center;
        gap: 12px;
        padding: 15px 25px;
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        margin-bottom: 25px;
        animation: slideIn 0.5s ease;
      }
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .success-message i {
        font-size: 24px;
      }
      .create-zone-card {
        display: none;
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
        margin-bottom: 25px;
      }
      .form-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 15px;
      }
      .form-row-3 {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
      }
      .form-field {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .form-field label {
        font-size: 14px;
        font-weight: 600;
        color: #555;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .form-field label.req::after {
        content: "*";
        color: #e74c3c;
        margin-left: 4px;
      }
      .form-field input,
      .form-field textarea {
        padding: 12px 15px;
        border: 1px solid #e1e8ed;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.3s ease;
        font-family: inherit;
      }
      .form-field input:focus,
      .form-field textarea:focus {
        outline: none;
        border-color: #8360c3;
        box-shadow: 0 0 0 3px rgba(131, 96, 195, 0.1);
      }
      .form-field textarea {
        resize: vertical;
        min-height: 100px;
      }
      .helper {
        font-size: 12px;
        color: #7f8c8d;
      }
      .checkline {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .actions-line {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 20px;
      }
      .btn-light {
        padding: 12px 24px;
        background: #ecf0f1;
        color: #7f8c8d;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .btn-light:hover {
        background: #bdc3c7;
        transform: translateY(-2px);
      }
      .btn-primary-solid {
        padding: 12px 24px;
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .btn-primary-solid:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(131, 96, 195, 0.4);
      }
      .filter-chips {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      .chip {
        padding: 10px 20px;
        background: white;
        border: 2px solid #e1e8ed;
        border-radius: 25px;
        font-size: 14px;
        font-weight: 500;
        color: #5a6c7d;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .chip:hover {
        border-color: #8360c3;
        color: #8360c3;
        transform: translateY(-2px);
      }
      .chip.active {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        color: white;
        border-color: transparent;
        box-shadow: 0 4px 15px rgba(131, 96, 195, 0.3);
      }
      .toolbar {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      .toolbar input {
        flex: 1;
        padding: 12px 20px;
        border: 2px solid #e1e8ed;
        border-radius: 25px;
        font-size: 14px;
        transition: all 0.3s ease;
      }
      .toolbar input:focus {
        outline: none;
        border-color: #8360c3;
        box-shadow: 0 0 0 3px rgba(131, 96, 195, 0.1);
      }
      .upload-zones-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
      }
      .zone-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      .zone-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #8360c3 0%, #2ebf91 100%);
      }
      .zone-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
      }
      .zone-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 15px;
      }
      .zone-title {
        font-size: 18px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 5px;
      }
      .zone-category {
        font-size: 12px;
        color: #7f8c8d;
        padding: 4px 10px;
        background: rgba(131, 96, 195, 0.1);
        border-radius: 12px;
        display: inline-block;
      }
      .zone-status {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
      }
      .zone-status.active {
        background: linear-gradient(
          135deg,
          rgba(40, 167, 69, 0.2) 0%,
          rgba(32, 201, 151, 0.2) 100%
        );
        color: #28a745;
      }
      .zone-status.closed {
        background: rgba(231, 76, 60, 0.2);
        color: #e74c3c;
      }
      .zone-description {
        font-size: 14px;
        color: #7f8c8d;
        margin-bottom: 20px;
        line-height: 1.6;
      }
      .zone-info {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-bottom: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
      }
      .zone-info-item {
        display: flex;
        flex-direction: column;
      }
      .zone-info-label {
        font-size: 12px;
        color: #95a5a6;
        margin-bottom: 5px;
      }
      .zone-info-value {
        font-size: 14px;
        font-weight: 600;
        color: #2c3e50;
      }
      .zone-stats {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
      }
      .zone-stat {
        flex: 1;
        text-align: center;
        padding: 12px;
        background: linear-gradient(
          135deg,
          rgba(131, 96, 195, 0.1) 0%,
          rgba(46, 191, 145, 0.1) 100%
        );
        border-radius: 10px;
      }
      .zone-stat-value {
        font-size: 24px;
        font-weight: 700;
        color: #8360c3;
        margin-bottom: 5px;
      }
      .zone-stat-label {
        font-size: 12px;
        color: #7f8c8d;
      }
      .zone-actions {
        display: flex;
        gap: 10px;
        padding-top: 20px;
        border-top: 1px solid #ecf0f1;
      }
      .btn-sm {
        padding: 8px 16px;
        font-size: 13px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }
      .btn-primary {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        color: white;
      }
      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(131, 96, 195, 0.4);
      }
      .btn-secondary {
        background: #ecf0f1;
        color: #7f8c8d;
      }
      .btn-secondary:hover {
        background: #bdc3c7;
        transform: translateY(-2px);
      }
      .btn-success {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
      }
      .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
      }
      .btn-danger {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
      }
      .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
      }

      /* Loading Overlay */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }
      .loading-overlay.active {
        display: flex;
      }
      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 5px solid rgba(255, 255, 255, 0.3);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Modal */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        padding: 20px;
      }
      .modal.active {
        display: flex;
      }
      .modal-content {
        background: white;
        border-radius: 15px;
        padding: 30px;
        max-width: 800px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
      }
      .modal-title {
        font-size: 24px;
        font-weight: 700;
        color: #2c3e50;
      }
      .modal-close {
        background: none;
        border: none;
        font-size: 28px;
        color: #95a5a6;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .modal-close:hover {
        color: #e74c3c;
        transform: rotate(90deg);
      }
      .file-list {
        display: grid;
        gap: 15px;
      }
      .file-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
        transition: all 0.3s ease;
      }
      .file-item:hover {
        background: #e9ecef;
        transform: translateX(5px);
      }
      .file-info {
        display: flex;
        align-items: center;
        gap: 15px;
        flex: 1;
      }
      .file-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 18px;
      }
      .file-details {
        flex: 1;
      }
      .file-name {
        font-size: 14px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 5px;
      }
      .file-meta {
        font-size: 12px;
        color: #7f8c8d;
      }
      .file-actions {
        display: flex;
        gap: 10px;
      }

      @media (max-width: 768px) {
        .sidebar {
          position: fixed;
          left: -280px;
          height: calc(100% - 70px);
          z-index: 1000;
        }
        .sidebar.active {
          left: 0;
        }
        .content {
          padding: 20px;
        }
        .upload-zones-container {
          grid-template-columns: 1fr;
        }
        .form-row-3 {
          grid-template-columns: 1fr;
        }
        .filter-chips {
          flex-wrap: wrap;
        }
        .toolbar {
          flex-direction: column;
        }
      }
    </style>
  </head>

  <body class="sci-page">
    <div class="header">
      <div
        class="header-left"
        onclick="location.href='science_club_activity_calendar.html';"
      >
        <img src="image/logo1.gif" alt="Logo" class="logo" />
      </div>
      <div class="header-right">
        <div class="icon-wrapper">
          <div class="icon" id="notificationBell">
            <i class="fas fa-bell"></i>
          </div>
          <div class="notification-badge" id="notificationBadge">0</div>
        </div>
        <div class="notification-panel" id="notificationPanel">
          <div class="notification-header">
            <h3><i class="fas fa-bell"></i> 通知中心</h3>
            <button class="mark-all-read">
              <i class="fas fa-check-double"></i> 全部已讀
            </button>
          </div>
          <div class="notification-list" id="notificationList">
            <div class="empty-notification">
              <i class="fas fa-inbox"></i>
              <p>沒有通知</p>
            </div>
          </div>
        </div>
        <div class="avatar" id="avatar">
          <i class="fas fa-user"></i>
        </div>
        <div class="dropdown" id="dropdown">
          <a href="login_teacher.html">
            <i class="fas fa-sign-out-alt"></i>
            登出
          </a>
        </div>
      </div>
    </div>

    <div class="main">
      <div class="sidebar">
        <div class="menu">
          <div class="menu-item">
            <a href="science_club_activity_calendar.html" class="menu-link">
              <i class="fas fa-calendar"></i>
              行事曆
            </a>
          </div>

          <div class="menu-item">
            <a href="science_club_event_album.html" class="menu-link">
              <i class="fas fa-image"></i>
              活動相簿
            </a>
          </div>

          <div class="menu-item">
            <div class="menu-link" onclick="toggleMenu(this); return false;">
              <i class="fas fa-bullhorn"></i>
              發佈公告/活動/表單
              <i class="fas fa-chevron-down menu-arrow"></i>
            </div>
            <div class="submenu">
              <div class="submenu-item">
                <a
                  href="science_club_publish_announcement.html"
                  class="submenu-link"
                >
                  <i class="fas fa-bullhorn"></i>
                  發佈公告
                </a>
              </div>
              <div class="submenu-item">
                <a
                  href="science_club_activity_publish.html"
                  class="submenu-link"
                >
                  <i class="fas fa-plus-circle"></i>
                  發佈比賽及活動
                </a>
              </div>
              <div class="submenu-item">
                <a href="science_club_table_publish.html" class="submenu-link">
                  <i class="fas fa-comment-alt"></i>
                  發佈活動反饋表單
                </a>
              </div>
            </div>
          </div>

        .zone-description {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #8360c3;
        }
        .zone-rules { color:#666; font-size:13px; line-height:1.6; padding:12px; background:#fff; border:1px dashed #e1e8ed; border-radius:8px; }
        .allowed-types { font-size:12px; color:#555; margin-top:6px; }

        .zone-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

          <div class="menu-item">
            <a href="science_club_request_review.html" class="menu-link">
              <i class="fas fa-file-signature"></i>
              請假申請
            </a>
          </div>

          <div class="menu-item">
            <a href="science_club_meeting_records.html" class="menu-link">
              <i class="fas fa-clipboard"></i>
              開會紀錄
            </a>
          </div>

          <div class="menu-item">
            <a href="science_club_image_recognition.html" class="menu-link">
              <i class="fas fa-eye"></i>
              圖片識別
            </a>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="page-header">
          <div class="page-title-section">
            <h1><i class="fas fa-cloud-upload-alt"></i>開放上傳檔案</h1>
          </div>
          <div class="header-actions">
            <button class="create-zone-btn" onclick="toggleCreateZone()">
              <i class="fas fa-plus"></i> 建立上傳區
            </button>
            <div class="current-time">
              <i class="fas fa-clock"></i>
              <span id="timeDisplay">2025年10月08日 星期三 下午01:35:14</span>
            </div>
          </div>
        </div>

        <div class="success-message" id="successMessage">
          <i class="fas fa-check-circle"></i>
          <span id="successMessageText">操作成功!</span>
        </div>

        <div class="create-zone-card" id="createZoneCard">
          <div class="form-grid">
            <div class="form-field">
              <label for="cz_name" class="req">標題</label>
              <input
                type="text"
                id="cz_name"
                placeholder="例如:網丙證照上傳"
                maxlength="15"
              />
              <span class="helper">上限 15 字</span>
            </div>
          </div>
          <div class="form-field" style="margin-top: 12px">
            <label for="cz_description" class="req">內容 / 說明</label>
            <textarea
              id="cz_description"
              placeholder="請輸入說明,包含繳交規定、檔名格式等"
            ></textarea>
          </div>
          <div class="form-row-3" style="margin-top: 12px">
            <div class="form-field">
              <label for="cz_deadline" class="req">截止時間</label>
              <input type="datetime-local" id="cz_deadline" />
            </div>
            <div class="form-field">
              <label for="cz_maxSize" class="req">單檔大小上限(MB)</label>
              <input type="number" id="cz_maxSize" min="1" value="10" />
            </div>
            <div class="form-field">
              <label for="cz_maxFiles" class="req">每人最多檔數</label>
              <input type="number" id="cz_maxFiles" min="1" value="3" />
            </div>
          </div>
          <div class="checkline" style="margin-top: 8px">
            <label style="font-weight: 600; color: #555" class="req"
              >允許副檔名：</label
            >
            <select
              id="cz_types"
              multiple
              style="
                flex: 1;
                padding: 8px 10px;
                border: 1px solid #e1e8ed;
                border-radius: 8px;
                min-height: 40px;
              "
            >
              <option value="pdf">pdf</option>
              <option value="jpg">jpg</option>
              <option value="png">png</option>
              <option value="jpeg">jpeg</option>
              <option value="doc">doc</option>
              <option value="docx">docx</option>
              <option value="ppt">ppt</option>
              <option value="pptx">pptx</option>
              <option value="zip">zip</option>
            </select>
            <span class="helper">可多選</span>
          </div>
          <div class="actions-line">
            <button class="btn-light" onclick="toggleCreateZone()">取消</button>
            <button class="btn-primary-solid" onclick="createZone()">
              <i class="fas fa-save"></i> 建立
            </button>
          </div>
        </div>

        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
          "
        >
          <div class="filter-chips" style="margin: 0">
            <div
              class="chip active"
              id="chip_all"
              onclick="setStatusFilter('all')"
            >
              全部
            </div>
            <div
              class="chip"
              id="chip_active"
              onclick="setStatusFilter('active')"
            >
              開放中
            </div>
            <div
              class="chip"
              id="chip_closed"
              onclick="setStatusFilter('closed')"
            >
              已截止
            </div>
          </div>

          <div class="toolbar" style="margin: 0">
            <input
              type="text"
              id="searchInput"
              placeholder="搜尋上傳區（標題/類別/描述）"
              oninput="renderUploadZones()"
            />
            <button class="btn-light" onclick="clearSearch()">
              <i class="fas fa-times"></i> 清除
            </button>
          </div>
        </div>

        <div class="upload-zones-container" id="uploadZones">
          <!-- 上傳區將由 JavaScript 動態生成 -->
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-spinner"></div>
    </div>

    <!-- 檢視檔案Modal -->
    <div class="modal" id="filesModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title" id="modalTitle">已上傳檔案</h2>
          <button class="modal-close" onclick="closeFilesModal()">×</button>
        </div>
        <div class="file-list" id="filesList">
          <!-- 檔案列表將由 JavaScript 動態生成 -->
        </div>
      </div>
    </div>

    <script>
      // ==========================================
      // 全域變數與配置
      // ==========================================
      const API_URL = 'api.php';
      let uploadZones = [];
      let currentStatusFilter = 'all';

      // ==========================================
      // 頁面初始化
      // ==========================================
      document.addEventListener('DOMContentLoaded', function() {
        initializePage();
      });

      function initializePage() {
        updateTime();
        setInterval(updateTime, 1000);
        loadUploadZones();
        setupEventListeners();
      }

      // ==========================================
      // 時間顯示
      // ==========================================
      function updateTime() {
        const now = new Date();
        const weekdays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
        const timeString = `${now.getFullYear()}年${String(now.getMonth() + 1).padStart(2, '0')}月${String(now.getDate()).padStart(2, '0')}日 ${weekdays[now.getDay()]} ${now.getHours() >= 12 ? '下午' : '上午'}${String(now.getHours() % 12 || 12).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
        const timeDisplay = document.getElementById('timeDisplay');
        if (timeDisplay) {
          timeDisplay.textContent = timeString;
        }
      }

      // ==========================================
      // 事件監聽器設置
      // ==========================================
      function setupEventListeners() {
        // 頭像下拉選單
        const avatar = document.getElementById('avatar');
        const dropdown = document.getElementById('dropdown');
        
        if (avatar) {
          avatar.addEventListener('click', function(e) {
            e.stopPropagation();
            if (dropdown) {
              dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
            }
          });
        }

        // 點擊外部關閉下拉選單
        document.addEventListener('click', function(e) {
          if (dropdown && avatar && !avatar.contains(e.target) && !dropdown.contains(e.target)) {
            dropdown.style.display = 'none';
          }
          
          // 關閉 Modal
          const modal = document.getElementById('filesModal');
          if (modal && modal.classList.contains('active') && e.target === modal) {
            closeFilesModal();
          }
        });
      }

      // ==========================================
      // Loading 控制
      // ==========================================
      function showLoading() {
        const overlay = document.getElementById('loadingOverlay');
        if (overlay) {
          overlay.classList.add('active');
        }
      }

      function hideLoading() {
        const overlay = document.getElementById('loadingOverlay');
        if (overlay) {
          overlay.classList.remove('active');
        }
      }

      // ==========================================
      // 提示訊息
      // ==========================================
      function showSuccessMessage(message) {
        const successMessage = document.getElementById('successMessage');
        const successMessageText = document.getElementById('successMessageText');
        
        if (successMessage && successMessageText) {
          successMessageText.textContent = message;
          successMessage.style.display = 'flex';

          setTimeout(() => {
            successMessage.style.display = 'none';
          }, 3000);

          successMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
      }

      // ==========================================
      // 載入上傳區列表
      // ==========================================
      async function loadUploadZones() {
        showLoading();
        try {
          const response = await fetch(`${API_URL}?action=get_upload_zones`);
          const result = await response.json();
          
          if (result.success) {
            // 轉換後端資料格式為前端格式
            uploadZones = result.data.map(zone => ({
              id: zone.zone_id,
              name: zone.zone_name,
              category: '一般上傳',
              description: zone.description || '',
              deadline: zone.deadline,
              maxFileSize: zone.max_file_size || 10,
              maxFiles: 3, // 後端沒有這個欄位，使用預設值
              allowedTypes: zone.file_types || '',
              uploadCount: 0,
              totalStudents: 0,
              status: zone.is_active == 1 ? 'active' : 'closed',
              files: [],
              created_at: zone.created_at
            }));
            
            // 為每個上傳區載入檔案數量
            await Promise.all(uploadZones.map(zone => loadZoneFileCount(zone)));
            
            renderUploadZones();
          } else {
            showSuccessMessage('載入失敗：' + result.message);
          }
        } catch (error) {
          console.error('載入上傳區失敗:', error);
          showSuccessMessage('網路連線錯誤');
        } finally {
          hideLoading();
        }
      }

      // 載入特定上傳區的檔案數量
      async function loadZoneFileCount(zone) {
        try {
          const response = await fetch(`${API_URL}?action=get_uploaded_files&zone_id=${zone.id}`);
          const result = await response.json();
          
          if (result.success && result.data) {
            zone.uploadCount = result.data.length;
            zone.files = result.data;
            // 計算不重複的學生數
            const uniqueStudents = new Set(result.data.map(f => f.student_number));
            zone.totalStudents = uniqueStudents.size;
          }
        } catch (error) {
          console.error('載入檔案數量失敗:', error);
        }

      // ==========================================
      // 渲染上傳區列表
      // ==========================================
      function renderUploadZones() {
        const searchTerm = (document.getElementById('searchInput')?.value || '').toLowerCase();
        const container = document.getElementById('uploadZones');
        
        if (!container) return;

        // 篩選上傳區
        let filteredZones = uploadZones.filter(zone => {
          const matchesSearch = zone.name.toLowerCase().includes(searchTerm) || 
                               zone.description.toLowerCase().includes(searchTerm) ||
                               zone.category.toLowerCase().includes(searchTerm);
          const matchesStatus = currentStatusFilter === 'all' || zone.status === currentStatusFilter;
          return matchesSearch && matchesStatus;
        });

        // 如果沒有資料
        if (filteredZones.length === 0) {
          container.innerHTML = `
            <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: white;">
              <i class="fas fa-inbox" style="font-size: 64px; margin-bottom: 20px; opacity: 0.5;"></i>
              <p style="font-size: 18px; font-weight: 500;">目前沒有上傳區</p>
              <button class="create-zone-btn" onclick="toggleCreateZone()" style="margin-top: 20px;">
                <i class="fas fa-plus"></i> 建立第一個上傳區
              </button>
            </div>
          `;
          return;
        }

        // 渲染上傳區卡片
        container.innerHTML = filteredZones.map(zone => `
          <div class="zone-card">
            <div class="zone-header">
              <div>
                <div class="zone-title">${escapeHtml(zone.name)}</div>
                <span class="zone-category">${escapeHtml(zone.category)}</span>
              </div>
              <span class="zone-status ${zone.status}">${zone.status === 'active' ? '開放中' : '已截止'}</span>
            </div>
            
            <div class="zone-description">${escapeHtml(zone.description)}</div>
            
            <div class="zone-info">
              <div class="zone-info-item">
                <div class="zone-info-label">截止時間</div>
                <div class="zone-info-value">${formatDateTime(zone.deadline)}</div>
              </div>
              <div class="zone-info-item">
                <div class="zone-info-label">檔案大小上限</div>
                <div class="zone-info-value">${zone.maxFileSize} MB</div>
              </div>
              <div class="zone-info-item">
                <div class="zone-info-label">允許格式</div>
                <div class="zone-info-value">${zone.allowedTypes || '所有格式'}</div>
              </div>
              <div class="zone-info-item">
                <div class="zone-info-label">建立時間</div>
                <div class="zone-info-value">${formatDateTime(zone.created_at)}</div>
              </div>
            </div>
            
            <div class="zone-stats">
              <div class="zone-stat">
                <div class="zone-stat-value">${zone.uploadCount}</div>
                <div class="zone-stat-label">已上傳</div>
              </div>
              <div class="zone-stat">
                <div class="zone-stat-value">${zone.totalStudents}</div>
                <div class="zone-stat-label">學生數</div>
              </div>
            </div>
            
            <div class="zone-actions">
              <button class="btn-primary btn-sm" onclick="viewFiles(${zone.id})">
                <i class="fas fa-eye"></i> 檢視
              </button>
              <button class="btn-${zone.status === 'active' ? 'secondary' : 'success'} btn-sm" 
                      onclick="toggleZoneStatus(${zone.id})">
                <i class="fas fa-${zone.status === 'active' ? 'lock' : 'lock-open'}"></i>
                ${zone.status === 'active' ? '關閉' : '開啟'}
              </button>
              <button class="btn-danger btn-sm" onclick="deleteZone(${zone.id})">
                <i class="fas fa-trash"></i> 刪除
              </button>
            </div>
          </div>
        `).join('');
      }

      // ==========================================
      // 狀態篩選
      // ==========================================
      function setStatusFilter(status) {
        currentStatusFilter = status;
        
        // 更新 chip 樣式
        document.querySelectorAll('.chip').forEach(chip => {
          chip.classList.remove('active');
        });
        document.getElementById(`chip_${status}`)?.classList.add('active');
        
        renderUploadZones();
      }

      // ==========================================
      // 搜尋功能
      // ==========================================
      function clearSearch() {
        const input = document.getElementById('searchInput');
        if (input) {
          input.value = '';
        }
        renderUploadZones();
      }

      // ==========================================
      // 建立上傳區
      // ==========================================
      function toggleCreateZone() {
        const card = document.getElementById('createZoneCard');
        if (card) {
          const isVisible = card.style.display === 'block';
          card.style.display = isVisible ? 'none' : 'block';
          
          if (!isVisible) {
            // 清空表單
            document.getElementById('cz_name').value = '';
            document.getElementById('cz_description').value = '';
            document.getElementById('cz_deadline').value = '';
            document.getElementById('cz_maxSize').value = 10;
            document.getElementById('cz_maxFiles').value = 3;
            Array.from(document.getElementById('cz_types').options).forEach(o => o.selected = false);
            
            // 滾動到表單
            card.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }
      }

      async function createZone() {
        const name = document.getElementById('cz_name').value.trim();
        const description = document.getElementById('cz_description').value.trim();
        const deadline = document.getElementById('cz_deadline').value;
        const maxFileSize = parseInt(document.getElementById('cz_maxSize').value, 10);
        const maxFiles = parseInt(document.getElementById('cz_maxFiles').value, 10);
        const typesSelect = document.getElementById('cz_types');
        const types = Array.from(typesSelect.selectedOptions)
          .map(o => o.value)
          .join(',');

        // 驗證
        if (!name || !description) {
          showSuccessMessage('請填寫標題與內容');
          return;
        }
        if (!deadline) {
          showSuccessMessage('請設定截止時間');
          return;
        }
        if (isNaN(maxFileSize) || maxFileSize <= 0) {
          showSuccessMessage('請輸入有效的大小上限');
          return;
        }
        if (isNaN(maxFiles) || maxFiles <= 0) {
          showSuccessMessage('請輸入有效的檔數上限');
          return;
        }
        if (!types) {
          showSuccessMessage('請選擇至少一種檔案類型');
          return;
        }

        showLoading();
        try {
          const formData = new FormData();
          formData.append('action', 'create_upload_zone');
          formData.append('zone_name', name);
          formData.append('description', description);
          formData.append('deadline', deadline);
          formData.append('max_file_size', maxFileSize);
          formData.append('file_types', types);

          const response = await fetch(API_URL, {
            method: 'POST',
            body: formData
          });
          
          const result = await response.json();
          
          if (result.success) {
            showSuccessMessage('上傳區已建立！');
            toggleCreateZone();
            await loadUploadZones();
          } else {
            showSuccessMessage('建立失敗：' + result.message);
          }
        } catch (error) {
          console.error('建立上傳區失敗:', error);
          showSuccessMessage('網路連線錯誤');
        } finally {
          hideLoading();
        }
      }

      // ==========================================
      // 切換上傳區狀態
      // ==========================================
      async function toggleZoneStatus(zoneId) {
        const zone = uploadZones.find(z => z.id === zoneId);
        if (!zone) return;

        const newStatus = zone.status === 'active' ? 0 : 1;
        
        showLoading();
        try {
          const formData = new FormData();
          formData.append('action', 'toggle_upload_zone_status');
          formData.append('zone_id', zoneId);
          formData.append('is_active', newStatus);

          const response = await fetch(API_URL, {
            method: 'POST',
            body: formData
          });
          
          const result = await response.json();
          
          if (result.success) {
            zone.status = newStatus === 1 ? 'active' : 'closed';
            renderUploadZones();
            showSuccessMessage(`上傳區已${zone.status === 'active' ? '開啟' : '關閉'}!`);
          } else {
            showSuccessMessage('操作失敗：' + result.message);
          }
        } catch (error) {
          console.error('切換狀態失敗:', error);
          // 如果後端沒有這個 API，就只在前端更新
          zone.status = newStatus === 1 ? 'active' : 'closed';
          renderUploadZones();
          showSuccessMessage(`上傳區已${zone.status === 'active' ? '開啟' : '關閉'}!`);
        } finally {
          hideLoading();
        }
      }

      // ==========================================
      // 刪除上傳區
      // ==========================================
      async function deleteZone(zoneId) {
        const zone = uploadZones.find(z => z.id === zoneId);
        if (!zone) return;

        if (!confirm(`確定要刪除「${zone.name}」嗎?\n此操作將同時刪除所有已上傳的檔案,且無法復原。`)) {
          return;
        }

        showLoading();
        try {
          const formData = new FormData();
          formData.append('action', 'delete_upload_zone');
          formData.append('zone_id', zoneId);

          const response = await fetch(API_URL, {
            method: 'POST',
            body: formData
          });
          
          const result = await response.json();
          
          if (result.success) {
            showSuccessMessage('上傳區已刪除!');
            await loadUploadZones();
          } else {
            showSuccessMessage('刪除失敗：' + result.message);
          }
        } catch (error) {
          console.error('刪除上傳區失敗:', error);
          showSuccessMessage('網路連線錯誤');
        } finally {
          hideLoading();
        }
      }

      // ==========================================
      // 檢視檔案
      // ==========================================
      async function viewFiles(zoneId) {
        const zone = uploadZones.find(z => z.id === zoneId);
        if (!zone) return;

        showLoading();
        try {
          const response = await fetch(`${API_URL}?action=get_uploaded_files&zone_id=${zoneId}`);
          const result = await response.json();
          
          if (result.success) {
            displayFilesModal(zone, result.data || []);
          } else {
            showSuccessMessage('載入檔案失敗：' + result.message);
          }
        } catch (error) {
          console.error('載入檔案失敗:', error);
          showSuccessMessage('網路連線錯誤');
        } finally {
          hideLoading();
        }
      }

      function displayFilesModal(zone, files) {
        const modal = document.getElementById('filesModal');
        const modalTitle = document.getElementById('modalTitle');
        const filesList = document.getElementById('filesList');

        if (!modal || !modalTitle || !filesList) return;

        modalTitle.textContent = `${zone.name} - 已上傳檔案 (${files.length})`;

        if (files.length === 0) {
          filesList.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #95a5a6;">
              <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
              <p style="font-size: 16px;">目前沒有檔案</p>
            </div>
          `;
        } else {
          filesList.innerHTML = files.map(file => {
            const fileExt = (file.file_extension || '').toLowerCase();
            const iconClass = getFileIcon(fileExt);
            
            return `
              <div class="file-item">
                <div class="file-info">
                  <div class="file-icon">
                    <i class="fas fa-${iconClass}"></i>
                  </div>
                  <div class="file-details">
                    <div class="file-name">${escapeHtml(file.title)}</div>
                    <div class="file-meta">
                      ${escapeHtml(file.student_name || '')} (${escapeHtml(file.student_number)}) 
                      · ${formatFileSize(file.file_size)} 
                      · ${formatDateTime(file.uploaded_at)}
                    </div>
                  </div>
                </div>
                <div class="file-actions">
                  <button class="btn-primary btn-sm" onclick="downloadFile('${file.image}', '${escapeHtml(file.title)}')">
                    <i class="fas fa-download"></i>
                  </button>
                  <button class="btn-danger btn-sm" onclick="deleteFile(${zone.id}, ${file.upload_id})">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            `;
          }).join('');
        }

        modal.classList.add('active');
      }

      function closeFilesModal() {
        const modal = document.getElementById('filesModal');
        if (modal) {
          modal.classList.remove('active');
        }
      }

      // ==========================================
      // 下載檔案
      // ==========================================
      function downloadFile(filePath, fileName) {
        const link = document.createElement('a');
        link.href = filePath;
        link.download = fileName;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showSuccessMessage('開始下載檔案');
      }

      // ==========================================
      // 刪除檔案
      // ==========================================
      async function deleteFile(zoneId, uploadId) {
        if (!confirm('確定要刪除此檔案嗎?')) {
          return;
        }

        showLoading();
        try {
          const formData = new FormData();
          formData.append('action', 'delete_uploaded_file');
          formData.append('upload_id', uploadId);

          const response = await fetch(API_URL, {
            method: 'POST',
            body: formData
          });
          
          const result = await response.json();
          
          if (result.success) {
            showSuccessMessage('檔案已刪除!');
            closeFilesModal();
            await loadUploadZones();
          } else {
            showSuccessMessage('刪除失敗：' + result.message);
          }
        } catch (error) {
          console.error('刪除檔案失敗:', error);
          showSuccessMessage('網路連線錯誤');
        } finally {
          hideLoading();
        }
      }

      // ==========================================
      // 子選單切換
      // ==========================================
      function toggleMenu(element) {
        const menuItem = element.closest('.menu-item');
        const submenu = menuItem.querySelector('.submenu');
        
        if (menuItem.classList.contains('expanded')) {
          menuItem.classList.remove('expanded');
        } else {
          // 關閉其他展開的選單
          document.querySelectorAll('.menu-item.expanded').forEach(item => {
            item.classList.remove('expanded');
          });
          menuItem.classList.add('expanded');
        }
      }

      // ==========================================
      // 工具函數
      // ==========================================
      function formatDateTime(dateTimeStr) {
        if (!dateTimeStr) return '未設定';
        const date = new Date(dateTimeStr);
        return date.toLocaleString('zh-TW', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
        });
      }

      function formatFileSize(bytes) {
        if (!bytes || bytes === 0) return '0 B';
        const k = 1024;
        const sizes = ['B', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
      }

      function getFileIcon(ext) {
        const iconMap = {
          'pdf': 'file-pdf',
          'doc': 'file-word',
          'docx': 'file-word',
          'xls': 'file-excel',
          'xlsx': 'file-excel',
          'ppt': 'file-powerpoint',
          'pptx': 'file-powerpoint',
          'zip': 'file-archive',
          'rar': 'file-archive',
          '7z': 'file-archive',
          'jpg': 'file-image',
          'jpeg': 'file-image',
          'png': 'file-image',
          'gif': 'file-image',
          'mp4': 'file-video',
          'avi': 'file-video',
          'mov': 'file-video',
          'mp3': 'file-audio',
          'wav': 'file-audio',
        };
        return iconMap[ext] || 'file';
      }

      function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
    </script>
</body>

</html>