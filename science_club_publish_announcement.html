<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <title>科學會管理系統-發佈公告</title>
    <!-- FontAwesome CDN -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <script src="notification-center.js" defer></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        font-family: "Microsoft JhengHei", "Arial", sans-serif;
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
      }

      /* 頂部區域 */
      .header {
        height: 70px;
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 30px;
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        position: relative;
        z-index: 100;
      }

      .header::before {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #8360c3 0%, #2ebf91 100%);
      }

      /* Logo 和標題區域 */
      .header-left {
        display: flex;
        align-items: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .header-left:hover {
        transform: scale(1.02);
      }

      .header img.logo {
        height: 50px;
        filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.1));
        transition: transform 0.3s ease;
        margin-right: 15px;
      }

      .header-title {
        font-size: 24px;
        font-weight: 300;
        color: #333;
        transition: color 0.3s ease;
      }

      .header-left:hover .header-title {
        color: #8360c3;
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 25px;
        position: relative;
      }

      .icon {
        position: relative;
        padding: 12px;
        border-radius: 50%;
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(131, 96, 195, 0.3);
        border: 2px solid rgba(255, 255, 255, 0.2);
        animation: pulse 2s infinite;
      }

      .icon:hover {
        transform: translateY(-3px) scale(1.1);
        box-shadow: 0 12px 35px rgba(131, 96, 195, 0.5);
        background: linear-gradient(135deg, #9d7ce6 0%, #3dd5a3 100%);
      }

      .icon:active {
        transform: translateY(-1px) scale(1.05);
        transition: all 0.1s ease;
      }

      .icon i {
        font-size: 20px;
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        animation: bellShake 0.5s ease-in-out infinite alternate;
      }

      .icon::after {
        position: absolute;
        top: -5px;
        right: -5px;
        background: linear-gradient(135deg, #ff4757 0%, #ff3742 100%);
        color: white;
        border-radius: 50%;
        width: 22px;
        height: 22px;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        box-shadow: 0 2px 8px rgba(255, 71, 87, 0.4);
        border: 2px solid white;
        animation: bounce 1s ease-in-out infinite;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      }

      .avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 3px solid #fff;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .avatar:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(131, 96, 195, 0.3);
      }

      .avatar i {
        font-size: 20px;
        color: white;
      }

      /* 下拉選單 */
      .dropdown {
        position: absolute;
        top: 65px;
        right: 0;
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        display: none;
        min-width: 120px;
        z-index: 1000;
        overflow: hidden;
        animation: dropdownFade 0.3s ease;
      }

      @keyframes dropdownFade {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 4px 15px rgba(131, 96, 195, 0.3);
        }
        50% {
          box-shadow: 0 4px 25px rgba(131, 96, 195, 0.6);
        }
        100% {
          box-shadow: 0 4px 15px rgba(131, 96, 195, 0.3);
        }
      }

      @keyframes bellShake {
        0% {
          transform: rotate(-5deg);
        }
        100% {
          transform: rotate(5deg);
        }
      }

      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-3px);
        }
        60% {
          transform: translateY(-2px);
        }
      }

      .dropdown a {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        text-decoration: none;
        color: #333;
        font-size: 14px;
        transition: all 0.2s ease;
      }

      .dropdown a:hover {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        color: white;
      }

      .dropdown a i {
        margin-right: 8px;
        width: 16px;
      }

      .notification-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background: linear-gradient(135deg, #ff4757 0%, #ff6348 100%);
        color: white;
        border-radius: 50%;
        width: 26px;
        height: 26px;
        font-size: 12px;
        display: none;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        border: 2px solid white;
        box-shadow: 0 4px 12px rgba(255, 71, 87, 0.5);
        animation: badgePulse 2s infinite;
      }
      .notification-badge.active {
        display: flex;
      }
      @keyframes badgePulse {
        0%,
        100% {
          transform: scale(1);
          box-shadow: 0 4px 12px rgba(255, 71, 87, 0.5);
        }
        50% {
          transform: scale(1.2);
          box-shadow: 0 6px 20px rgba(255, 71, 87, 0.8);
        }
      }
      .notification-panel {
        position: absolute;
        top: 65px;
        right: 0;
        background: white;
        border-radius: 15px;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
        display: none;
        width: 400px;
        max-height: 550px;
        z-index: 1001;
        overflow: hidden;
        animation: panelFade 0.3s ease;
        flex-direction: column;
      }
      @keyframes panelFade {
        from {
          opacity: 0;
          transform: translateY(-15px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      .notification-panel.active {
        display: flex;
      }
      .notification-header {
        padding: 20px 25px;
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
      }
      .notification-header h3 {
        font-size: 17px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .notification-header i {
        font-size: 20px;
      }
      .mark-all-read {
        background: rgba(255, 255, 255, 0.25);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 7px 14px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 600;
        transition: all 0.3s ease;
      }
      .mark-all-read:hover {
        background: rgba(255, 255, 255, 0.35);
        border-color: rgba(255, 255, 255, 0.5);
        transform: translateY(-2px);
      }
      .notification-list {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
      }
      .notification-item {
        padding: 16px;
        margin-bottom: 8px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        background: #f8f9fa;
        border-left: 4px solid transparent;
        position: relative;
      }
      .notification-item:hover {
        background: #f0f1f2;
        transform: translateX(4px);
      }
      .notification-item.unread {
        background: linear-gradient(135deg, #e8f9f8 0%, #f0fffe 100%);
        border-left-color: #11998e;
        box-shadow: 0 2px 8px rgba(17, 153, 142, 0.15);
      }
      .notification-item.unread::after {
        content: "";
        position: absolute;
        top: 8px;
        right: 8px;
        width: 10px;
        height: 10px;
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        border-radius: 50%;
        animation: unreadPulse 2s infinite;
      }
      @keyframes unreadPulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.2);
          opacity: 0.8;
        }
      }
      .notification-item-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
      }
      .notification-item-title {
        font-weight: 700;
        color: #333;
        flex: 1;
        margin-right: 10px;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .notification-type-icon {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        color: white;
        flex-shrink: 0;
      }
      .notification-type-icon.info {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      }
      .notification-type-icon.warning {
        background: linear-gradient(135deg, #ff9800 0%, #ffc107 100%);
      }
      .notification-item-time {
        font-size: 12px;
        color: #999;
        white-space: nowrap;
      }
      .notification-item-message {
        font-size: 13px;
        color: #666;
        line-height: 1.5;
        margin-bottom: 10px;
        font-weight: 500;
      }
      .notification-actions {
        display: flex;
        gap: 8px;
      }
      .notification-btn {
        font-size: 11px;
        padding: 6px 12px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 4px;
      }
      .notification-btn-read {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        box-shadow: 0 2px 8px rgba(17, 153, 142, 0.2);
      }
      .notification-btn-read:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(17, 153, 142, 0.4);
      }
      .notification-btn-clear {
        background: #ffe8e8;
        color: #d32f2f;
        box-shadow: 0 2px 8px rgba(211, 47, 47, 0.1);
      }
      .notification-btn-clear:hover {
        background: #ffcccb;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(211, 47, 47, 0.2);
      }
      .empty-notification {
        padding: 50px 20px;
        text-align: center;
        color: #999;
      }
      .empty-notification i {
        font-size: 45px;
        margin-bottom: 15px;
        opacity: 0.4;
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      .empty-notification p {
        font-weight: 600;
        font-size: 14px;
      }

.icon-wrapper {
        position: relative;
      }

      /* 主體區域 */
      .main {
        display: flex;
        height: calc(100% - 70px);
        gap: 0;
      }

      .sidebar {
        width: 280px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 30px 0;
        display: flex;
        flex-direction: column;
        box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow-y: auto;
      }

      .sidebar::before {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(180deg, #8360c3 0%, #2ebf91 100%);
      }

      .menu {
        flex: 1;
        margin-top: 20px;
      }

      .menu-item {
        display: block;
        position: relative;
      }

      .menu-link {
        display: flex;
        align-items: center;
        padding: 15px 25px;
        text-decoration: none;
        color: #555;
        font-size: 15px;
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
        cursor: pointer;
      }

      .menu-link:hover,
      .menu-link.active {
        color: #8360c3;
        background: rgba(131, 96, 195, 0.1);
        border-left: 4px solid #8360c3;
        transform: translateX(5px);
      }

      .menu-link i {
        margin-right: 12px;
        width: 20px;
        font-size: 16px;
      }

      .menu-arrow {
        margin-left: auto;
        font-size: 12px;
        transition: transform 0.3s ease;
      }

      .menu-item.expanded .menu-arrow {
        transform: rotate(180deg);
      }

      /* 二級選單 */
      .submenu {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        background: rgba(131, 96, 195, 0.05);
      }

      .submenu.show {
        max-height: 500px;
      }

      .submenu-item {
        position: relative;
      }

      .submenu-link {
        display: flex;
        align-items: center;
        padding: 12px 25px 12px 45px;
        text-decoration: none;
        color: #666;
        font-size: 14px;
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
        cursor: pointer;
      }

      .submenu-link:hover {
        color: #8360c3;
        background: rgba(131, 96, 195, 0.1);
        border-left: 4px solid #8360c3;
        transform: translateX(5px);
      }

      .submenu-link.active {
        color: #8360c3;
        background: rgba(131, 96, 195, 0.1);
        border-left: 4px solid #8360c3;
        transform: translateX(5px);
      }

      .submenu-link i {
        margin-right: 10px;
        width: 16px;
        font-size: 14px;
      }

      /* 三級選單 */
      .sub-submenu {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        background: rgba(131, 96, 195, 0.03);
      }

      .sub-submenu.show {
        max-height: 300px;
      }

      .sub-submenu-link {
        display: flex;
        align-items: center;
        padding: 10px 25px 10px 65px;
        text-decoration: none;
        color: #777;
        font-size: 13px;
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
      }

      .sub-submenu-link:hover {
        color: #8360c3;
        background: rgba(131, 96, 195, 0.08);
        border-left: 4px solid #8360c3;
        transform: translateX(5px);
      }

      .sub-submenu-link i {
        margin-right: 8px;
        width: 14px;
        font-size: 12px;
      }

      /* 內容區域 */
      .content {
        flex: 1;
        padding: 40px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        display: flex;
        flex-direction: column;
        overflow-y: auto;
      }

      /* 頁面標題 */
      .page-header {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px 40px;
        margin-bottom: 30px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .page-title-section h1 {
        font-size: 28px;
        color: #333;
        margin-bottom: 10px;
        font-weight: 600;
        display: flex;
        align-items: center;
      }

      .page-title-section h1 i {
        margin-right: 15px;
        color: #8360c3;
        font-size: 32px;
      }

      .page-title-section p {
        color: #666;
        font-size: 16px;
        line-height: 1.6;
      }

      /* 時間顯示區域 */
      .time-display {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        color: white;
        padding: 10px 20px;
        border-radius: 25px;
        font-size: 14px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 2px 10px rgba(131, 96, 195, 0.3);
        white-space: nowrap;
      }

      .time-display i {
        font-size: 16px;
        color: white;
      }

      /* 發佈表單 */
      .publish-form {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        margin-bottom: 30px;
      }

      .form-section {
        margin-bottom: 30px;
      }

      .form-section h3 {
        font-size: 18px;
        color: #333;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        font-weight: 600;
      }

      .form-section h3 i {
        margin-right: 10px;
        color: #8360c3;
        font-size: 20px;
      }

      .form-group {
        margin-bottom: 25px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #444;
        font-size: 14px;
      }

      .required::after {
        content: "*";
        color: #ff4757;
        margin-left: 4px;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e1e8ed;
        border-radius: 10px;
        font-size: 14px;
        transition: all 0.3s ease;
        background: white;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #8360c3;
        box-shadow: 0 0 0 3px rgba(131, 96, 195, 0.1);
        transform: translateY(-1px);
      }

      .form-group textarea {
        min-height: 120px;
        resize: vertical;
        font-family: inherit;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      /* 優先級選擇 */
      /* 優先級別相關樣式已移除 */

      /* 附件上傳 */
      .file-upload {
        border: 2px dashed #e1e8ed;
        border-radius: 10px;
        padding: 40px 20px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
        background: #fafbfc;
      }

      .file-upload:hover {
        border-color: #8360c3;
        background: rgba(131, 96, 195, 0.05);
      }

      .file-upload.dragover {
        border-color: #8360c3;
        background: rgba(131, 96, 195, 0.1);
        transform: scale(1.02);
      }

      .file-upload i {
        font-size: 48px;
        color: #8360c3;
        margin-bottom: 15px;
      }

      .file-upload p {
        color: #666;
        font-size: 16px;
        margin-bottom: 10px;
      }

      .file-upload small {
        color: #999;
        font-size: 12px;
      }

      .file-list {
        margin-top: 15px;
      }

      .file-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 15px;
        background: white;
        border: 1px solid #e1e8ed;
        border-radius: 8px;
        margin-bottom: 8px;
      }

      .file-info {
        display: flex;
        align-items: center;
      }

      .file-info i {
        margin-right: 10px;
        color: #8360c3;
      }

      .remove-file {
        color: #ff4757;
        cursor: pointer;
        padding: 5px;
        border-radius: 5px;
        transition: all 0.2s ease;
      }

      .remove-file:hover {
        background: rgba(255, 71, 87, 0.1);
      }

      /* 按鈕區域 */
      .form-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 30px;
        border-top: 1px solid #e1e8ed;
        margin-top: 30px;
      }

      .btn {
        padding: 12px 30px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(131, 96, 195, 0.4);
      }

      .btn-secondary {
        background: #f8f9fa;
        color: #666;
        border: 2px solid #e1e8ed;
      }

      .btn-secondary:hover {
        background: #e9ecef;
        transform: translateY(-1px);
      }

      .btn-success {
        background: linear-gradient(135deg, #2ed573 0%, #17a2b8 100%);
        color: white;
      }

      .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(46, 213, 115, 0.4);
      }

      /* 複選框 */
      .checkbox-group {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
      }

      .checkbox-group input[type="checkbox"] {
        width: auto;
        margin: 0;
        margin-right: 8px;
      }

      /* 預覽區域 */
      .preview-section {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        display: block; /* 預覽區塊保持顯示 */
      }

      /* 公告列表 */
      .announcement-list {
        margin-top: 20px;
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
      }
      .announcement-card {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        background: #fff;
        border: 1px solid #e1e8ed;
        border-radius: 12px;
        padding: 16px 18px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      }
      .announcement-info {
        color: #444;
      }
      .announcement-title {
        font-weight: 700;
        margin-bottom: 6px;
      }
      .announcement-meta {
        font-size: 12px;
        color: #777;
      }
      .announcement-actions {
        display: flex;
        gap: 8px;
      }
      .btn-xs {
        padding: 6px 10px;
        font-size: 12px;
        border-radius: 8px;
      }
      .btn-edit {
        background: #f0f0f0;
        border: 1px solid #ddd;
        color: #555;
      }
      .btn-edit:hover {
        background: #e9e9e9;
      }
      .btn-delete {
        background: #ffefef;
        border: 1px solid #f3b2b2;
        color: #e74c3c;
      }
      .btn-delete:hover {
        background: #ffe3e3;
      }

      .preview-section h3 {
        font-size: 20px;
        color: #333;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        font-weight: 600;
      }

      .preview-section h3 i {
        margin-right: 10px;
        color: #8360c3;
      }

      .announcement-preview {
        border: 1px solid #e1e8ed;
        border-radius: 15px;
        padding: 25px;
        background: white;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      }

      .preview-header {
        display: flex;
        align-items: center;
        justify-content: between;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #f1f3f4;
      }

      .preview-title {
        font-size: 20px;
        font-weight: 600;
        color: #8360c3;
        margin-bottom: 5px;
        word-break: break-word;
        overflow-wrap: anywhere;
      }

      .preview-meta {
        font-size: 14px;
        color: #999;
        margin-bottom: 12px;
      }

      .preview-content {
        line-height: 1.8;
        color: #444;
        font-size: 15px;
        white-space: pre-wrap;
        word-break: break-word;
        overflow-wrap: anywhere;
      }

      /* 媒體預覽 */
      .media-preview {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin-top: 8px;
      }
      .media-thumb {
        width: 180px;
        height: 120px;
        border: 1px solid #e1e8ed;
        border-radius: 10px;
        overflow: hidden;
        background: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .media-thumb img {
        max-width: 100%;
        max-height: 100%;
        display: block;
      }
      .media-thumb video {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      /* 兩欄版面：左表單 / 右預覽+草稿箱 */
      .content-grid {
        display: grid;
        grid-template-columns: 1.6fr 1fr;
        gap: 24px;
        align-items: start;
      }
      .left-col {
        min-width: 0;
      }
      .right-col {
        position: relative;
      }
      .right-sticky {
        position: sticky;
        top: 20px;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      /* 響應式設計 */
      @media (max-width: 768px) {
        .main {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
          height: auto;
        }

        .content {
          padding: 20px;
        }

        .content-grid {
          grid-template-columns: 1fr;
        }
        .right-sticky {
          position: static;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .priority-options {
          flex-direction: column;
        }

        .form-actions {
          flex-direction: column;
          gap: 15px;
        }

        .page-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 20px;
        }

        .time-display {
          align-items: flex-start;
        }
      }

      /* 滾動條美化 */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1);
      }

      ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #2ebf91 0%, #8360c3 100%);
      }

      /* 成功提示 */
      .success-message {
        background: rgba(46, 213, 115, 0.1);
        border: 1px solid #2ed573;
        color: #27ae60;
        padding: 15px 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        display: none;
      }

      .success-message i {
        margin-right: 10px;
      }

      /* 右側預覽區維持既有 sticky 行為（移除固定定位以避免跑版） */
    </style>
  </head>

  <body class="sci-page">
    <!-- 頂部欄 -->
    <div class="header">
      <div
        class="header-left"
        onclick="location.href='science_club_activity_calendar.html';"
      >
        <img src="image/logo1.gif" alt="Logo" class="logo" />
      </div>
      <div class="header-right">
        <div class="icon-wrapper">
          <div class="icon" id="notificationBell">
            <i class="fas fa-bell"></i>
          </div>
          <div class="notification-badge" id="notificationBadge">0</div>
        </div>
        <div class="notification-panel" id="notificationPanel">
          <div class="notification-header">
            <h3><i class="fas fa-bell"></i> 通知中心</h3>
            <button class="mark-all-read">
              <i class="fas fa-check-double"></i> 全部已讀
            </button>
          </div>
          <div class="notification-list" id="notificationList">
            <div class="empty-notification">
              <i class="fas fa-inbox"></i>
              <p>沒有通知</p>
            </div>
          </div>
        </div>
        <div class="avatar" id="avatar">
          <i class="fas fa-user"></i>
        </div>
        <div class="dropdown" id="dropdown">
          <a href="login_science_club.html">
            <i class="fas fa-sign-out-alt"></i>
            登出
          </a>
        </div>
      </div>
    </div>

    <div class="main">
      <div class="sidebar">
        <div class="menu">
          <div class="menu-item">
            <a href="science_club_activity_calendar.html" class="menu-link">
              <i class="fas fa-calendar"></i>
              行事曆
            </a>
          </div>

          <div class="menu-item">
            <a href="science_club_event_album.html" class="menu-link">
              <i class="fas fa-home"></i>
              活動相簿
            </a>
          </div>

          <div class="menu-item expanded">
            <div class="menu-link" onclick="toggleMenu(this); return false;">
              <i class="fas fa-bullhorn"></i>
              發佈公告/活動/表單
              <i class="fas fa-chevron-down menu-arrow"></i>
            </div>
            <div class="submenu show">
              <div class="submenu-item">
                <a
                  href="science_club_publish_announcement.html"
                  class="submenu-link active"
                >
                  <i class="fas fa-bullhorn"></i>
                  發佈公告
                </a>
              </div>
              <div class="submenu-item">
                <a
                  href="science_club_activity_publish.html"
                  class="submenu-link"
                >
                  <i class="fas fa-plus-circle"></i>
                  發佈比賽及活動
                </a>
              </div>
              <div class="submenu-item">
                <a href="science_club_table_publish.html" class="submenu-link">
                  <i class="fas fa-comment-alt"></i>
                  發佈活動反饋表單
                </a>
              </div>
            </div>
          </div>

          <div class="menu-item">
            <a href="science_club_name_manage.html" class="menu-link">
              <i class="fas fa-user-edit"></i>
              報名人員名單管理
            </a>
          </div>

          <div class="menu-item">
            <a href="science_club_statistics.html" class="menu-link">
              <i class="fas fa-trophy"></i>
              統計比賽名次
            </a>
          </div>

          <div class="menu-item">
            <a href="science_club_upload_files.html" class="menu-link">
              <i class="fas fa-upload"></i>
              開放上傳檔案
            </a>
          </div>

          <div class="menu-item">
            <a href="science_club_request_review.html" class="menu-link">
              <i class="fas fa-file-signature"></i>
              請假申請
            </a>
          </div>

          <div class="menu-item">
            <a href="science_club_meeting_records.html" class="menu-link">
              <i class="fas fa-clipboard"></i>
              開會紀錄
            </a>
          </div>

          <div class="menu-item">
            <a href="science_club_image_recognition.html" class="menu-link">
              <i class="fas fa-eye"></i>
              圖片識別
            </a>
          </div>
        </div>
      </div>

      <div class="content">
        <!-- 頁面標題 -->
        <div class="page-header">
          <div class="page-title-section">
            <h1><i class="fas fa-bullhorn"></i>發布公告</h1>
          </div>
          <div class="time-display">
            <i class="fas fa-clock"></i>
            <span id="timeDisplay">2025年09月18日 星期四 上午09:56:44</span>
          </div>
        </div>

        <!-- 成功訊息 -->
        <div class="success-message" id="successMessage">
          <i class="fas fa-check-circle"></i>
          公告發布成功！
        </div>

        <div class="content-grid">
          <div class="left-col">
            <!-- 發佈表單 -->
            <div class="publish-form">
              <form id="announcementForm">
                <!-- 基本資訊 -->
                <div class="form-section">
                  <h3><i class="fas fa-info-circle"></i>基本資訊</h3>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="title" class="required">公告標題</label>
                      <input
                        type="text"
                        id="title"
                        name="title"
                        placeholder="請輸入公告標題"
                        maxlength="15"
                        required
                      />
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="content" class="required">公告內容</label>
                    <textarea
                      id="content"
                      name="content"
                      placeholder="請輸入公告詳細內容..."
                      required
                    ></textarea>
                  </div>
                </div>

                <!-- 發佈設定 -->
                <div class="form-section">
                  <h3><i class="fas fa-cog"></i>發佈設定</h3>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="publishDate">發佈日期</label>
                      <input type="date" id="publishDate" name="publishDate" />
                    </div>
                    <div class="form-group">
                      <label for="expireDate">到期日期</label>
                      <input type="date" id="expireDate" name="expireDate" />
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="publishTime">發佈時間</label>
                      <input type="time" id="publishTime" name="publishTime" />
                    </div>
                    <div class="form-group">
                      <label for="expireTime">到期時間</label>
                      <input type="time" id="expireTime" name="expireTime" />
                    </div>
                  </div>
                </div>

                <!-- 附件上傳 -->
                <div class="form-section">
                  <h3><i class="fas fa-paperclip"></i>附件上傳</h3>

                  <div class="file-upload" id="fileUpload">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>拖放檔案至此處或點擊選擇檔案</p>
                    <small>支援圖片、PDF、Word 文件等格式，單檔最大 10MB</small>
                    <input
                      type="file"
                      id="fileInput"
                      multiple
                      style="display: none"
                    />
                  </div>

                  <div class="file-list" id="fileList"></div>
                </div>

                <!-- 通知設定 -->
                <div class="form-section">
                  <h3><i class="fas fa-bell"></i>通知設定</h3>

                  <div class="checkbox-group">
                    <input
                      type="checkbox"
                      id="emailNotify"
                      name="emailNotify"
                      checked
                    />
                    <label for="emailNotify">發送電子郵件通知</label>
                  </div>

                  <div class="checkbox-group">
                    <input
                      type="checkbox"
                      id="pushNotify"
                      name="pushNotify"
                      checked
                    />
                    <label for="pushNotify">推送即時通知</label>
                  </div>
                </div>

                <!-- 按鈕區域 -->
                <div class="form-actions">
                  <div>
                    <button
                      type="button"
                      class="btn btn-secondary"
                      onclick="clearForm()"
                    >
                      <i class="fas fa-eraser"></i>清空表單
                    </button>
                    <button
                      type="button"
                      class="btn btn-secondary"
                      onclick="saveAsDraft()"
                    >
                      <i class="fas fa-save"></i>儲存草稿
                    </button>
                  </div>
                  <div>
                    <button
                      type="button"
                      class="btn btn-success"
                      onclick="previewAnnouncement()"
                    >
                      <i class="fas fa-eye"></i>預覽
                    </button>
                    <button type="submit" class="btn btn-primary">
                      <i class="fas fa-paper-plane"></i>發布公告
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>

          <div class="right-col">
            <div class="right-sticky">
              <!-- 預覽區域 -->
              <div class="preview-section" id="previewSection">
                <h3><i class="fas fa-eye"></i>公告預覽</h3>
                <div class="announcement-preview">
                  <div class="preview-header">
                    <div>
                      <div class="preview-title" id="previewTitle">
                        活動名稱
                      </div>
                      <div class="preview-meta" id="previewMeta">
                        日期與時間將顯示於此
                      </div>
                    </div>
                  </div>
                  <div class="preview-content" id="previewContent">
                    活動描述將顯示於此...
                  </div>
                  <div class="media-preview" id="mediaPreview"></div>
                </div>
              </div>

              <!-- 草稿箱 -->
              <div class="preview-section" id="draftSection">
                <h3><i class="fas fa-box-archive"></i>草稿箱</h3>
                <div id="draftList" class="announcement-list"></div>
              </div>

              <!-- 已發佈公告 -->
              <div class="preview-section">
                <h3><i class="fas fa-list"></i>已發佈公告</h3>
                <div id="announcementList" class="announcement-list"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- JavaScript -->
    <script>
      let announcements = [];
      let editingId = null; // 當前編輯中的公告 id

      // 更新時間顯示
      function updateTime() {
        const now = new Date();

        // 格式化完整的時間日期字串
        const options = {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          weekday: "long",
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
          hour12: true,
        };

        let timeString = now.toLocaleDateString("zh-TW", options);

        // 調整格式為：2025年09月18日 星期四 上午09:56:44
        timeString = timeString
          .replace(/(\d{4})\/(\d{1,2})\/(\d{1,2})/, "$1年$2月$3日")
          .replace(/\s+/g, " "); // 規範化空白字符

        document.getElementById("timeDisplay").textContent = timeString;
      }

      // 頁面載入後立即執行
      document.addEventListener("DOMContentLoaded", function () {
        updateTime();
        // 每秒更新時間
        setInterval(updateTime, 1000);
        renderAnnouncementList();
      });

      // 一級選單控制
      function toggleMenu(element) {
        const menuItem = element.parentElement;
        const submenu = menuItem.querySelector(".submenu");
        const isExpanded = menuItem.classList.contains("expanded");

        // 關閉所有其他一級選單
        document.querySelectorAll(".menu-item").forEach((item) => {
          if (item !== menuItem) {
            item.classList.remove("expanded");
            const otherSubmenu = item.querySelector(".submenu");
            if (otherSubmenu) {
              otherSubmenu.classList.remove("show");
            }
          }
        });

        // 切換當前選單（可以展開也可以收合）
        if (isExpanded) {
          menuItem.classList.remove("expanded");
          submenu.classList.remove("show");
        } else {
          menuItem.classList.add("expanded");
          submenu.classList.add("show");
        }
      }

      // 優先級選擇已移除

      // 檔案上傳處理
      const fileUpload = document.getElementById("fileUpload");
      const fileInput = document.getElementById("fileInput");
      const fileList = document.getElementById("fileList");
      let uploadedFiles = [];
      let draftEditingId = null; // 當前編輯中的草稿 id（與已發佈公告的 editingId 區分）

      fileUpload.addEventListener("click", () => fileInput.click());

      fileUpload.addEventListener("dragover", (e) => {
        e.preventDefault();
        fileUpload.classList.add("dragover");
      });

      fileUpload.addEventListener("dragleave", () => {
        fileUpload.classList.remove("dragover");
      });

      fileUpload.addEventListener("drop", (e) => {
        e.preventDefault();
        fileUpload.classList.remove("dragover");
        handleFiles(e.dataTransfer.files);
      });

      fileInput.addEventListener("change", (e) => {
        handleFiles(e.target.files);
      });

      function handleFiles(files) {
        Array.from(files).forEach((file) => {
          if (file.size <= 10 * 1024 * 1024) {
            // 10MB限制
            uploadedFiles.push(file);
            addFileToList(file);
            updateMediaPreview();
          } else {
            alert(`檔案 ${file.name} 超過 10MB 限制`);
          }
        });
      }

      function addFileToList(file) {
        const fileItem = document.createElement("div");
        fileItem.className = "file-item";
        fileItem.innerHTML = `
          <div class="file-info">
            <i class="fas fa-file"></i>
            <span>${file.name} (${formatFileSize(file.size)})</span>
          </div>
          <i class="fas fa-times remove-file" onclick="removeFile('${
            file.name
          }', this)"></i>
        `;
        fileList.appendChild(fileItem);
      }

      function removeFile(fileName, element) {
        uploadedFiles = uploadedFiles.filter((file) => file.name !== fileName);
        element.parentElement.remove();
        updateMediaPreview();
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
      }

      // 媒體預覽（影像/影片）
      function updateMediaPreview() {
        const container = document.getElementById("mediaPreview");
        if (!container) return;
        container.innerHTML = "";
        uploadedFiles.forEach((file) => {
          const url = URL.createObjectURL(file);
          const wrapper = document.createElement("div");
          wrapper.className = "media-thumb";
          if (file.type.startsWith("image/")) {
            const img = document.createElement("img");
            img.src = url;
            wrapper.appendChild(img);
          } else if (file.type.startsWith("video/")) {
            const video = document.createElement("video");
            video.src = url;
            video.controls = true;
            wrapper.appendChild(video);
          } else {
            // 非影像/影片不在此顯示
            return;
          }
          container.appendChild(wrapper);
        });
      }

      function updateFileList() {
        const container = document.getElementById("fileList");
        if (!container) return;
        container.innerHTML = "";
        uploadedFiles.forEach((file) => {
          addFileToList(file);
        });
      }

      // 預覽功能
      function previewAnnouncement() {
        const title = document.getElementById("title").value;
        const content = document.getElementById("content").value;
        // 類別與優先級別已移除

        if (!title || !content) {
          alert("請填寫標題和內容");
          return;
        }

        // 移除對應文字映射

        document.getElementById("previewTitle").textContent = title;
        document.getElementById("previewMeta").textContent =
          new Date().toLocaleDateString("zh-TW");
        // 已不顯示類別與優先級
        document.getElementById("previewContent").textContent = content;

        document.getElementById("previewSection").style.display = "block";
        document
          .getElementById("previewSection")
          .scrollIntoView({ behavior: "smooth" });

        // 如果目前不是編輯流程，僅顯示預覽不影響列表
        updateMediaPreview();
      }

      function renderAnnouncementList() {
        const list = document.getElementById("announcementList");
        if (!list) return;
        // 先移除過期公告
        removeExpiredAnnouncements();
        if (announcements.length === 0) {
          list.innerHTML =
            '<div style="color:#999; text-align:center; padding:12px;">目前沒有公告</div>';
          return;
        }
        list.innerHTML = "";
        announcements.forEach((a) => {
          // 渲染時略過過期公告（雙保險）
          if (
            a.expireDateLocal &&
            new Date(a.expireDateLocal).getTime() <= Date.now()
          ) {
            return;
          }
          const card = document.createElement("div");
          card.className = "announcement-card";
          card.innerHTML = `
            <div class="announcement-info">
              <div class="announcement-title">${a.title}</div>
              <div class="announcement-meta">發布時間：${a.publishDate}</div>
            </div>
            <div class="announcement-actions">
              <button class="btn btn-xs btn-edit" onclick="editAnnouncement(${a.id})"><i class="fas fa-edit"></i> 編輯</button>
              <button class="btn btn-xs btn-delete" onclick="deleteAnnouncement(${a.id})"><i class="fas fa-trash"></i> 刪除</button>
            </div>
          `;
          list.appendChild(card);
        });
      }

      // 依據到期時間移除公告
      function removeExpiredAnnouncements() {
        const beforeLength = announcements.length;
        announcements = announcements.filter((a) => {
          if (!a.expireDateLocal) return true;
          const expireMs = new Date(a.expireDateLocal).getTime();
          return isNaN(expireMs) || expireMs > Date.now();
        });
        if (announcements.length !== beforeLength) {
          // 若有變化則重繪
          const list = document.getElementById("announcementList");
          if (list) {
            list.innerHTML = "";
          }
        }
      }

      function editAnnouncement(id) {
        const a = announcements.find((x) => x.id === id);
        if (!a) return;
        editingId = id;
        // 帶入表單
        document.getElementById("title").value = a.title;
        document.getElementById("content").value = a.content;
        document.getElementById("publishDate").value = a.publishDateLocal;
        document.getElementById("expireDate").value = a.expireDateLocal || "";
        document.getElementById("emailNotify").checked = a.emailNotify;
        document.getElementById("pushNotify").checked = a.pushNotify;
        // 變更送出按鈕文字，提供明確回饋
        const submitBtn = document.querySelector(
          "#announcementForm .btn.btn-primary"
        );
        if (submitBtn)
          submitBtn.innerHTML = '<i class="fas fa-save"></i>儲存修改';
        // 捲動到表單頂部
        document
          .getElementById("announcementForm")
          .scrollIntoView({ behavior: "smooth", block: "start" });
        // 顯示預覽區域與更新預覽
        previewAnnouncement();
      }

      function deleteAnnouncement(id) {
        const a = announcements.find((x) => x.id === id);
        if (!a) return;
        if (!confirm(`確定刪除公告「${a.title}」嗎？`)) return;
        announcements = announcements.filter((x) => x.id !== id);
        renderAnnouncementList();
        alert("✅ 公告已刪除");
      }

      // 清空表單
      function clearForm() {
        if (confirm("確定要清空表單嗎？此操作無法復原。")) {
          document.getElementById("announcementForm").reset();
          uploadedFiles = [];
          fileList.innerHTML = "";
          // 保持預覽區塊顯示，並重設預設文案
          document.getElementById("previewSection").style.display = "block";
          document.getElementById("previewTitle").textContent = "活動名稱";
          document.getElementById("previewMeta").textContent =
            "日期與時間將顯示於此";
          document.getElementById("previewContent").textContent =
            "活動描述將顯示於此...";

          // 重置編輯狀態與按鈕文字
          editingId = null;
          draftEditingId = null;
          const submitBtn = document.querySelector(
            "#announcementForm .btn.btn-primary"
          );
          if (submitBtn)
            submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i>發布公告';
          const media = document.getElementById("mediaPreview");
          if (media) media.innerHTML = "";
        }
      }

      // 儲存草稿
      function saveAsDraft() {
        const draftData = {
          title: document.getElementById("title").value,
          content: document.getElementById("content").value,
          publishDate: document.getElementById("publishDate").value,
          expireDate: document.getElementById("expireDate").value,
          emailNotify: document.getElementById("emailNotify").checked,
          pushNotify: document.getElementById("pushNotify").checked,
          files: uploadedFiles.map((file) => file.name),
        };
        // 寫入 localStorage
        const drafts = loadDrafts();
        if (draftEditingId) {
          const idx = drafts.findIndex((d) => d.id === draftEditingId);
          if (idx > -1) {
            drafts[idx] = {
              ...drafts[idx],
              ...draftData,
              updatedAt: Date.now(),
            };
          }
          saveDrafts(drafts);
          alert("草稿已更新！");
        } else {
          const id = Date.now();
          drafts.unshift({
            id,
            ...draftData,
            createdAt: Date.now(),
            updatedAt: Date.now(),
          });
          saveDrafts(drafts);
          alert("草稿已儲存！");
        }
        renderDraftList();
      }

      // 表單提交處理
      document
        .getElementById("announcementForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const formData = new FormData();
          formData.append("action", "add_announcement");
          formData.append("title", document.getElementById("title").value);
          formData.append("content", document.getElementById("content").value);
          try {
            const response = await fetch('api.php', {
              method: 'POST',
              body: formData
            });
            
            const result = await response.json();
            
            if (result.success) {
              showNotification('✅ 公告發布成功！', 'success');
              // 重新載入已發佈公告
              loadPublishedAnnouncementsFromAPI();
              // 清空表單
              document.getElementById("announcementForm").reset();
              uploadedFiles = [];
              updateFileList();
            } else {
              showNotification('❌ 發布失敗: ' + result.message, 'error');
            }
          } catch (error) {
            console.error('提交錯誤:', error);
            showNotification('❌ 提交時發生錯誤', 'error');
          }
        });

      // 草稿存取與渲染
      const DRAFTS_KEY = "sc_announcement_drafts";
      function loadDrafts() {
        try {
          const raw = localStorage.getItem(DRAFTS_KEY);
          return raw ? JSON.parse(raw) : [];
        } catch (e) {
          return [];
        }
      }
      function saveDrafts(list) {
        localStorage.setItem(DRAFTS_KEY, JSON.stringify(list));
      }
      function renderDraftList() {
        const container = document.getElementById("draftList");
        if (!container) return;
        const drafts = loadDrafts();
        if (drafts.length === 0) {
          container.innerHTML =
            '<div style="color:#999; text-align:center; padding:12px;">目前沒有草稿</div>';
          return;
        }
        container.innerHTML = "";
        drafts.forEach((d) => {
          const card = document.createElement("div");
          card.className = "announcement-card";
          card.innerHTML = `
            <div class="announcement-info">
              <div class="announcement-title">${d.title || "未命名草稿"}</div>
              <div class="announcement-meta">更新時間：${new Date(
                d.updatedAt
              ).toLocaleString("zh-TW")}</div>
            </div>
            <div class="announcement-actions">
              <button class="btn btn-xs btn-success" onclick="publishDraft(${
                d.id
              })"><i class=\"fas fa-paper-plane\"></i> 發佈</button>
              <button class="btn btn-xs btn-edit" onclick="editDraft(${
                d.id
              })"><i class=\"fas fa-edit\"></i> 修改</button>
              <button class="btn btn-xs btn-delete" onclick="deleteDraft(${
                d.id
              })"><i class=\"fas fa-trash\"></i> 刪除</button>
            </div>
          `;
          container.appendChild(card);
        });
      }
      function publishDraft(id) {
        const drafts = loadDrafts();
        const d = drafts.find((x) => x.id === id);
        if (!d) return;
        const publishDateDisplay = new Date().toLocaleString("zh-TW");
        const newId = announcements.length
          ? Math.max(...announcements.map((a) => a.id)) + 1
          : 1;
        announcements.unshift({
          id: newId,
          title: d.title,
          content: d.content,
          publishDate: publishDateDisplay,
          publishDateLocal: d.publishDate,
          expireDateLocal: d.expireDate,
          emailNotify: d.emailNotify,
          pushNotify: d.pushNotify,
        });
        const filtered = drafts.filter((x) => x.id !== id);
        saveDrafts(filtered);
        renderAnnouncementList();
        renderDraftList();
        document.getElementById("previewSection").style.display = "block";
        document.getElementById("successMessage").style.display = "block";
        setTimeout(() => {
          document.getElementById("successMessage").style.display = "none";
        }, 2000);
      }
      function editDraft(id) {
        const drafts = loadDrafts();
        const d = drafts.find((x) => x.id === id);
        if (!d) return;
        draftEditingId = id;
        document.getElementById("title").value = d.title || "";
        document.getElementById("content").value = d.content || "";
        document.getElementById("publishDate").value = d.publishDate || "";
        document.getElementById("expireDate").value = d.expireDate || "";
        document.getElementById("emailNotify").checked = !!d.emailNotify;
        document.getElementById("pushNotify").checked = !!d.pushNotify;
        // 檔案名稱僅保留於列表展示；不還原真實 File 物件
        uploadedFiles = [];
        fileList.innerHTML = "";
        (d.files || []).forEach((name) => {
          // 僅顯示名稱，無法重建 File；提示使用者重新選取檔案
          const item = document.createElement("div");
          item.className = "file-item";
          item.innerHTML = `
            <div class="file-info">
              <i class="fas fa-file"></i>
              <span>${name}</span>
            </div>
          `;
          fileList.appendChild(item);
        });
        const submitBtn = document.querySelector(
          "#announcementForm .btn.btn-primary"
        );
        if (submitBtn)
          submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i>發布公告';
        document
          .getElementById("announcementForm")
          .scrollIntoView({ behavior: "smooth", block: "start" });
        previewAnnouncement();
      }
      function deleteDraft(id) {
        if (!confirm("確定刪除此草稿嗎？")) return;
        const drafts = loadDrafts();
        const filtered = drafts.filter((x) => x.id !== id);
        saveDrafts(filtered);
        renderDraftList();
        alert("草稿已刪除");
      }

      // 設定預設發布日期為當前時間
      window.addEventListener("load", function () {
        const now = new Date();
        const today = now.toISOString().split("T")[0];
        document.getElementById("publishDate").value = today;

        // 設定預設到期日期為30天後
        const expireDate = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);
        const expireDateString = expireDate.toISOString().split("T")[0];
        document.getElementById("expireDate").value = expireDateString;

        // 初始渲染草稿箱
        renderDraftList();
        // 每30秒檢查到期下架
        setInterval(() => {
          removeExpiredAnnouncements();
          renderAnnouncementList();
        }, 30000);
      });

      // 實時更新字數統計
      const contentTextarea = document.getElementById("content");
      const titleInput = document.getElementById("title");

      function addCharacterCount() {
        // 為內容添加字數統計
        if (!document.getElementById("contentCount")) {
          const contentCount = document.createElement("small");
          contentCount.id = "contentCount";
          contentCount.style.color = "#999";
          contentCount.style.fontSize = "12px";
          contentCount.textContent = "0 字";
          contentTextarea.parentNode.appendChild(contentCount);
        }

        // 為標題添加字數統計
        if (!document.getElementById("titleCount")) {
          const titleCount = document.createElement("small");
          titleCount.id = "titleCount";
          titleCount.style.color = "#999";
          titleCount.style.fontSize = "12px";
          titleCount.textContent = "0/15字";
          titleInput.parentNode.appendChild(titleCount);
        }
      }

      contentTextarea.addEventListener("input", function () {
        const count = this.value.length;
        document.getElementById("contentCount").textContent = count + " 字";

        if (count > 1000) {
          document.getElementById("contentCount").style.color = "#ff4757";
        } else {
          document.getElementById("contentCount").style.color = "#999";
        }
      });

      titleInput.addEventListener("input", function () {
        const count = this.value.length;
        document.getElementById("titleCount").textContent = count + "/15字";

        if (count > 15) {
          document.getElementById("titleCount").style.color = "#ff4757";
        } else {
          document.getElementById("titleCount").style.color = "#999";
        }
      });

      // 頁面載入完成後初始化
      window.addEventListener("load", function () {
        addCharacterCount();
      });

      // 通知函數
      function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 15px 20px;
          border-radius: 8px;
          color: white;
          font-weight: 500;
          z-index: 10000;
          max-width: 300px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          animation: slideIn 0.3s ease;
        `;
        
        // 根據類型設置背景色
        switch(type) {
          case 'success':
            notification.style.background = 'linear-gradient(135deg, #2ed573 0%, #7bed9f 100%)';
            break;
          case 'error':
            notification.style.background = 'linear-gradient(135deg, #ff4757 0%, #ff6b7a 100%)';
            break;
          default:
            notification.style.background = 'linear-gradient(135deg, #3742fa 0%, #5352ed 100%)';
        }
        
        notification.textContent = message;
        document.body.appendChild(notification);
        
        // 3秒後自動移除
        setTimeout(() => {
          notification.style.animation = 'slideOut 0.3s ease';
          setTimeout(() => {
            if (notification.parentNode) {
              notification.parentNode.removeChild(notification);
            }
          }, 300);
        }, 3000);
      }

      // 添加動畫樣式
      if (!document.querySelector('#notification-styles')) {
        const style = document.createElement('style');
        style.id = 'notification-styles';
        style.textContent = `
          @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
          @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
          }
        `;
        document.head.appendChild(style);
      }


      // 點擊其他地方關閉所有選單
      document.addEventListener("click", function (e) {
        if (!e.target.closest(".menu")) {
          document.querySelectorAll(".menu-item").forEach((item) => {
            item.classList.remove("expanded");
            const submenu = item.querySelector(".submenu");
            if (submenu) {
              submenu.classList.remove("show");
            }
            item.querySelectorAll(".submenu-item").forEach((subItem) => {
              subItem.classList.remove("expanded");
              const subSubmenu = subItem.querySelector(".sub-submenu");
              if (subSubmenu) {
                subSubmenu.classList.remove("show");
              }
            });
          });
        }
      });

      // ========== 新增：從API載入已發佈公告 ==========
      // 頁面載入時從API讀取已發佈公告
      window.addEventListener("load", function () {
        loadPublishedAnnouncementsFromAPI();
      });

      async function loadPublishedAnnouncementsFromAPI() {
        try {
          const response = await fetch('api.php?action=get_announcements');
          const result = await response.json();
          
          if (result.success && result.data) {
            // 將API資料轉換為前端格式
            announcements = result.data.map(item => ({
              id: item.announcement_id,
              title: item.title || '未命名公告',
              content: item.content || '',
              publishDate: item.created_at ? new Date(item.created_at).toLocaleString('zh-TW') : '',
              publishDateLocal: item.created_at ? item.created_at.split(' ')[0] : '',
              expireDateLocal: null, // API中沒有到期日期
              emailNotify: false,
              pushNotify: false
            }));
            
            // 渲染公告列表
            renderAnnouncementList();
            console.log('✅ 成功從API載入', announcements.length, '個公告');
          }
        } catch (error) {
          console.error('❌ 載入已發佈公告時發生錯誤:', error);
          // 如果API載入失敗，顯示空列表
          announcements = [];
          renderAnnouncementList();
        }
      }
      // ========== 新增結束 ==========
    </script>
  </body>
</html>