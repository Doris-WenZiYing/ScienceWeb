<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>線上排班系統</title>
  <!-- FontAwesome CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      font-family: 'Microsoft JhengHei', 'Arial', sans-serif;
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }

    /* 頂部區域 */
    .header {
      height: 70px;
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 30px;
      box-shadow: 0 2px 20px rgba(0,0,0,0.1);
      position: relative;
      z-index: 100;
    }

    .header::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #11998e 0%, #38ef7d 100%);
    }

    .header img.logo {
      height: 50px;
      filter: drop-shadow(0 2px 8px rgba(0,0,0,0.1));
      transition: transform 0.3s ease;
    }

    .header img.logo:hover {
      transform: scale(1.05);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 25px;
      position: relative;
    }

    .icon {
      position: relative;
      padding: 10px;
      border-radius: 50%;
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .icon:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(17, 153, 142, 0.4);
    }

    .icon i {
      font-size: 18px;
      color: white;
    }

    .icon::after {
      content: '3';
      position: absolute;
      top: -2px;
      right: -2px;
      background: #ff4757;
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 11px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 3px solid #fff;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .avatar:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(17, 153, 142, 0.3);
    }

    .avatar i {
      font-size: 20px;
      color: white;
    }

    /* 下拉選單 */
    .dropdown {
      position: absolute;
      top: 65px;
      right: 0;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      display: none;
      min-width: 120px;
      z-index: 1000;
      overflow: hidden;
      animation: dropdownFade 0.3s ease;
    }

    @keyframes dropdownFade {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .dropdown a {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      text-decoration: none;
      color: #333;
      font-size: 14px;
      transition: all 0.2s ease;
    }

    .dropdown a:hover {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
    }

    .dropdown a i {
      margin-right: 8px;
      width: 16px;
    }

    /* 主體區域 */
    .main {
      display: flex;
      height: calc(100% - 70px);
      gap: 0;
    }

    .sidebar {
      width: 250px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 30px 0;
      display: flex;
      flex-direction: column;
      box-shadow: 2px 0 20px rgba(0,0,0,0.1);
      position: relative;
    }

    .sidebar::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, #11998e 0%, #38ef7d 100%);
    }

    .menu a {
      display: flex;
      align-items: center;
      padding: 18px 30px;
      text-decoration: none;
      color: #555;
      font-size: 16px;
      transition: all 0.3s ease;
      border-left: 4px solid transparent;
      position: relative;
    }

    .menu a:hover, .menu a.active {
      color: #11998e;
      background: rgba(17, 153, 142, 0.1);
      border-left: 4px solid #11998e;
      transform: translateX(5px);
    }

    .menu a i {
      margin-right: 15px;
      width: 20px;
      font-size: 18px;
    }

    .content {
      flex: 1;
      padding: 40px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    /* 標題區域 */
    .page-header {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      padding: 30px 40px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
    }

    .page-header h1 {
      font-size: 28px;
      color: #333;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }

    .page-header h1 i {
      margin-right: 15px;
      color: #11998e;
    }

    .page-header p {
      font-size: 16px;
      color: #666;
    }

    /* 控制面板 */
    .control-panel {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
    }

    .control-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      align-items: center;
    }

    .control-group {
      flex: 1;
      min-width: 200px;
    }

    .control-group label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-size: 14px;
      font-weight: 500;
    }

    .control-group input,
    .control-group select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.3s ease;
      font-family: 'Microsoft JhengHei', 'Arial', sans-serif;
    }

    .control-group input:focus,
    .control-group select:focus {
      outline: none;
      border-color: #11998e;
      box-shadow: 0 0 0 3px rgba(17, 153, 142, 0.1);
    }

    .btn-group {
      display: flex;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'Microsoft JhengHei', 'Arial', sans-serif;
    }

    .btn-primary {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(17, 153, 142, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(17, 153, 142, 0.4);
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background: #5a6268;
      transform: translateY(-2px);
    }

    .btn-success {
      background: #28a745;
      color: white;
    }

    .btn-success:hover {
      background: #218838;
      transform: translateY(-2px);
    }

    .btn-danger {
      background: #dc3545;
      color: white;
    }

    .btn-danger:hover {
      background: #c82333;
      transform: translateY(-2px);
    }

    /* 排班表格 */
    .schedule-container {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      overflow-x: auto;
    }

    .schedule-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px;
    }

    .schedule-table thead {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
    }

    .schedule-table th {
      padding: 15px;
      text-align: center;
      font-weight: 600;
      font-size: 15px;
    }

    .schedule-table tbody tr {
      border-bottom: 1px solid #e0e0e0;
      transition: background 0.3s ease;
    }

    .schedule-table tbody tr:hover {
      background: rgba(17, 153, 142, 0.05);
    }

    .schedule-table td {
      padding: 15px;
      text-align: center;
      font-size: 14px;
      color: #555;
    }

    .schedule-table td:first-child {
      font-weight: 600;
      color: #11998e;
      background: rgba(17, 153, 142, 0.05);
    }

    .schedule-table input {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      text-align: center;
      font-size: 14px;
      transition: all 0.3s ease;
      font-family: 'Microsoft JhengHei', 'Arial', sans-serif;
    }

    .schedule-table input:focus {
      outline: none;
      border-color: #11998e;
      box-shadow: 0 0 0 2px rgba(17, 153, 142, 0.1);
    }

    .schedule-table input:read-only {
      background: #f8f9fa;
      cursor: not-allowed;
    }

    /* 響應式設計 */
    @media (max-width: 768px) {
      .main {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        height: auto;
      }
      
      .menu {
        display: flex;
        overflow-x: auto;
      }
      
      .menu a {
        white-space: nowrap;
        padding: 15px 20px;
      }

      .content {
        padding: 20px;
      }

      .control-row {
        flex-direction: column;
      }

      .control-group {
        width: 100%;
      }

      .btn-group {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }
    }

    /* 滾動條美化 */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.1);
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #38ef7d 0%, #11998e 100%);
    }

    /* 統計資訊 */
    .stats-bar {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 15px;
      padding: 20px 30px;
      margin-bottom: 30px;
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .stat-item {
      text-align: center;
    }

    .stat-item .stat-value {
      font-size: 24px;
      font-weight: 600;
      color: #11998e;
      margin-bottom: 5px;
    }

    .stat-item .stat-label {
      font-size: 13px;
      color: #666;
    }
  </style>
</head>
<body>
  <!-- 頂部欄 -->
  <div class="header">
    <img src="image/logo1.gif" alt="Logo" class="logo">
    
    <div class="header-right">
      <!-- 通知圖標 -->
      <div class="icon"><i class="fas fa-bell"></i></div>
      
      <!-- 頭像 -->
      <div class="avatar" id="avatar">
        <i class="fas fa-user"></i>
      </div>
      
      <!-- 下拉選單 -->
      <div class="dropdown" id="dropdown">
        <a href="login_teacher.html">
          <i class="fas fa-sign-out-alt"></i>
          登出
        </a>
      </div>
    </div>
  </div>

  <!-- 主區塊 -->
  <div class="main">
    <div class="sidebar">
      <div class="menu">
        <a href="teacher_dashboard.html">
          <i class="fas fa-home"></i>
          老師首頁
        </a>
        <a href="activity_status.html">
          <i class="fas fa-chart-bar"></i>
          查看活動情況
        </a>
        <a href="registration_statistics.html">
          <i class="fas fa-users"></i>
          報名數據統計
        </a>
        <a href="form_feedback.html">
          <i class="fas fa-comments"></i>
          學生表單反饋
        </a>
        <a href="Teacher_schedules_classes.html">
          <i class="fas fa-calendar-alt"></i>
          線上排班
        </a>
        <a href="askforleave.html">
          <i class="fas fa-clipboard-check"></i>
          請假審核
        </a>
        <a href="work_hours_attendance.html">
          <i class="fas fa-clock"></i>
          工作時數與出席記錄
        </a>
             </div>
    </div>
    
    <div class="content">
      <!-- 頁面標題 -->
      <div class="page-header">
        <h1><i class="fas fa-calendar-alt"></i>線上排班管理</h1>
        <p>管理工作人員班表，格式像課表一樣，可以填入執勤人員，並匯出表格</p>
      </div>

      <!-- 統計資訊 -->
      <div class="stats-bar">
        <div class="stat-item">
          <div class="stat-value" id="totalShifts">0</div>
          <div class="stat-label">總班次</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="filledShifts">0</div>
          <div class="stat-label">已排班</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="emptyShifts">0</div>
          <div class="stat-label">未排班</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="fillRate">0%</div>
          <div class="stat-label">排班率</div>
        </div>
      </div>

      <!-- 控制面板 -->
      <div class="control-panel">
        <div class="control-row">
          <div class="control-group">
            <label for="weekStart">選擇週次起始日</label>
            <input type="date" id="weekStart">
          </div>
          <div class="control-group">
            <label for="shiftType">班次類型</label>
            <select id="shiftType">
              <option value="default">標準班次</option>
              <option value="morning">早班(08:00-16:00)</option>
              <option value="afternoon">晚班(16:00-24:00)</option>
              <option value="night">夜班(00:00-08:00)</option>
              <option value="custom">自定義</option>
            </select>
          </div>
        </div>

        <div class="btn-group">
          <button class="btn btn-primary" onclick="generateSchedule()">
            <i class="fas fa-sync-alt"></i>
            生成班表
          </button>
          <button class="btn btn-success" onclick="saveSchedule()">
            <i class="fas fa-save"></i>
            保存班表
          </button>
          <button class="btn btn-secondary" onclick="exportToExcel()">
            <i class="fas fa-file-excel"></i>
            匯出Excel
          </button>
          <button class="btn btn-danger" onclick="clearSchedule()">
            <i class="fas fa-trash"></i>
            清空班表
          </button>
        </div>
      </div>

      <!-- 排班表格 -->
      <div class="schedule-container">
        <table class="schedule-table" id="scheduleTable">
          <thead>
            <tr>
              <th style="min-width: 100px;">時段</th>
              <th>星期一</th>
              <th>星期二</th>
              <th>星期三</th>
              <th>星期四</th>
              <th>星期五</th>
              <th>星期六</th>
              <th>星期日</th>
            </tr>
          </thead>
          <tbody id="scheduleBody">
            <!-- 動態生成 -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- JS 控制 -->
  <script>
    const avatar = document.getElementById('avatar');
    const dropdown = document.getElementById('dropdown');

    // 下拉選單控制
    avatar.addEventListener('click', () => {
      dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
    });

    // 點擊其他地方關閉選單
    window.addEventListener('click', function(e) {
      if (!avatar.contains(e.target) && !dropdown.contains(e.target)) {
        dropdown.style.display = 'none';
      }
    });

    // 預設時段
    const defaultTimeSlots = [
      '08:00-09:00',
      '09:00-10:00',
      '10:00-11:00',
      '11:00-12:00',
      '12:00-13:00',
      '13:00-14:00',
      '14:00-15:00',
      '15:00-16:00',
      '16:00-17:00',
      '17:00-18:00'
    ];

    const scheduleData = {};

    // 生成班表
    function generateSchedule() {
      const tbody = document.getElementById('scheduleBody');
      tbody.innerHTML = '';

      const weekStart = document.getElementById('weekStart').value;
      const days = ['星期一', '星期二', '星期三', '星期四', '星期五', '星期六', '星期日'];

      defaultTimeSlots.forEach((timeSlot, index) => {
        const row = document.createElement('tr');
        
        // 時段列
        const timeCell = document.createElement('td');
        timeCell.textContent = timeSlot;
        row.appendChild(timeCell);

        // 各天的輸入框
        days.forEach((day, dayIndex) => {
          const cell = document.createElement('td');
          const input = document.createElement('input');
          input.type = 'text';
          input.placeholder = '輸入人員姓名';
          input.dataset.time = timeSlot;
          input.dataset.day = day;
          
          // 如果有保存的數據，載入它
          const key = `${timeSlot}-${day}`;
          if (scheduleData[key]) {
            input.value = scheduleData[key];
          }

          // 監聽變更
          input.addEventListener('input', function() {
            scheduleData[key] = this.value;
            updateStats();
          });

          cell.appendChild(input);
          row.appendChild(cell);
        });

        tbody.appendChild(row);
      });

      updateStats();
      
      // 提示訊息
      showNotification('班表已生成！', 'success');
    }

    // 更新統計
    function updateStats() {
      const totalShifts = defaultTimeSlots.length * 7;
      let filledShifts = 0;

      Object.values(scheduleData).forEach(value => {
        if (value && value.trim() !== '') {
          filledShifts++;
        }
      });

      const emptyShifts = totalShifts - filledShifts;
      const fillRate = totalShifts > 0 ? Math.round((filledShifts / totalShifts) * 100) : 0;

      document.getElementById('totalShifts').textContent = totalShifts;
      document.getElementById('filledShifts').textContent = filledShifts;
      document.getElementById('emptyShifts').textContent = emptyShifts;
      document.getElementById('fillRate').textContent = fillRate + '%';
    }

    // 保存班表
    function saveSchedule() {
      const inputs = document.querySelectorAll('.schedule-table input');
      let saveData = {};

      inputs.forEach(input => {
        const key = `${input.dataset.time}-${input.dataset.day}`;
        saveData[key] = input.value;
      });

      // 保存到 scheduleData
      Object.assign(scheduleData, saveData);

      showNotification('班表已保存！', 'success');
    }

    // 清空班表
    function clearSchedule() {
      if (confirm('確定要清空整個班表嗎？此操作無法復原。')) {
        const inputs = document.querySelectorAll('.schedule-table input');
        inputs.forEach(input => {
          input.value = '';
          const key = `${input.dataset.time}-${input.dataset.day}`;
          delete scheduleData[key];
        });
        updateStats();
        showNotification('班表已清空！', 'info');
      }
    }

    // 匯出到Excel (使用CSV格式)
    function exportToExcel() {
      const table = document.getElementById('scheduleTable');
      let csv = [];
      
      // 獲取表頭
      const headers = [];
      table.querySelectorAll('thead th').forEach(th => {
        headers.push(th.textContent);
      });
      csv.push(headers.join(','));

      // 獲取數據
      table.querySelectorAll('tbody tr').forEach(tr => {
        const row = [];
        tr.querySelectorAll('td').forEach((td, index) => {
          if (index === 0) {
            row.push(td.textContent);
          } else {
            const input = td.querySelector('input');
            row.push(input ? input.value : '');
          }
        });
        csv.push(row.join(','));
      });

      // 創建下載
      const csvContent = '\uFEFF' + csv.join('\n'); // 加上BOM以支援中文
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      
      const weekStart = document.getElementById('weekStart').value || '未設定日期';
      link.setAttribute('href', url);
      link.setAttribute('download', `排班表_${weekStart}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);

      showNotification('班表已匯出！', 'success');
    }

    // 通知訊息
    function showNotification(message, type) {
      const colors = {
        success: '#28a745',
        info: '#17a2b8',
        warning: '#ffc107',
        error: '#dc3545'
      };

      const notification = document.createElement('div');
      notification.textContent = message;
      notification.style.cssText = `
        position: fixed;
        top: 100px;
        right: 30px;
        background: ${colors[type] || colors.info};
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        z-index: 10000;
        animation: slideIn 0.3s ease;
      `;

      document.body.appendChild(notification);

      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }

    // 設置今天的日期為預設值
    window.addEventListener('load', () => {
      const today = new Date();
      const dateString = today.toISOString().split('T')[0];
      document.getElementById('weekStart').value = dateString;
      
      // 自動生成班表
      generateSchedule();
    });

    // CSS動畫
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>